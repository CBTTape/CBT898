*********************************************************************** DPSO6170
*                                                                       DPSO6170
* THIS FACILITY IS USED TO NAVIGATE AROUND CICS MEMORY.                 DPSO7027
*                                                                       DPSO7027
* MEMBERS REQUIRED TO PACKAGE THIS FACILITY:                            DPSO7027
*     TP08T95  - THIS PROGRAM (REQUIRES TRANSLATION)                    DPSO7027
*     KPS0824  - ASSEMBLER MODULE USING OLD CICS MACRO                  DPSO7027
*                'DFHTM' TO RETURN ADDRESSES OF CICS                    DPSO7027
*                FACILITIES. (MAY NOT BE 4.1 COMPLIANT, HOWEVER         DPSO7027
*                IT WOULD ONLY PREVENT ISSUING THE FOLLOWING            DPSO7027
*                COMMANDS: DCT, FCT, PCT(X), PPT, TCT(X)).              DPSO7027
*     KPW0825  - COMMON COPYBOOK FOR KPS0824 PROCESSING.                DPSO7027
*     CICS@    - MACRO TO RETURN THEORETICALLY VERBOTTEN DATA           DPSO7027
*                AREA ADDRESSES: CSA, CWA & TCA.                        DPSO7027
*                                                                       DPSO7027
* LIST OF COMMANDS:                                                     DPSO7027
*     DCT, FCT, PCT, PCTR, PFT, PPT, TCT, TCTN, TCTS                    DPSO7027
*              - WITH A PARAMETER, RETURNS THE ADDRESS TO THAT
*                FACILITY.                                              DPSO7027
*     ADDRESS | ADDR | A                                                DPSO7027
*              - FOLLOWED BY ONE OF THE FOLLOWING SEPERATORS ' ', '=',  DPSO7027
*                ':', '_' WILL DISPLAY THE REQUIRED ADDRESS
*     ABENDOFF -                                                        DPSO7027
*     ABENDON  -                                                        DPSO7027
*     AEFI     - 'AEF' INCLUDE LIST (ONLY VALID AT GECF)                DPSO7027
*     AEFX     - 'AEF' EXCLUDE LIST (ONLY VALID AT GECF)                DPSO7027
*     AICB     -                     CONTROL BLOCK (QUICK MOVE)         DPSO7027
*     AFCB     - AUTHORISED FUNCTION CONTROL BLOCK (QUICK MOVE)         DPSO7027
*     BASE3, B3                                                         DPSO7027
*              -                                                        DPSO7027
*     BASE, B  -                                                        DPSO7027
*                                                                       DPSO7027
*     CEMT     - INVOKES CEMT DIRECT                                    DPSO7027
*     CSA, CWA - VERBOTTEN CICS ADDRESSES                               DPSO7027
*     FIND | F - FIND TEXT. MAY PASS A HEX STRING ENCLOSED IN X'  '     DPSO7027
*     INQUIRE | IP                                                      DPSO7027
*              - RETURN BASIC STATS FOR INQUIRED PROGRAM                DPSO7027
*     LOADHOLD | LH                                                     DPSO7027
*              - LOAD HELD PROGRAM                                      DPSO7027
*     LOADMOD  | LM                                                     DPSO7027
*              - ????                                                   DPSO7027
*     LOAD | L - LOAD PROGRAM                                           DPSO7027
*     NEWCOPY | NEW | N                                                 DPSO7027
*              - NEW COPY A PROGRAM                                     DPSO7027
*     OFFSET | OFF | O                                                  DPSO7027
*              - ????                                                   DPSO7027
*     OPEN | CLOSE                                                      DPSO7027
*              - OPEN/CLOSE FILES                                       DPSO7027
*     PASSWORD | PASS                                                   DPSO7027
*              - ????                                                   DPSO7027
*     PROTECT  - ????                                                   DPSO7027
*              - OPEN/CLOSE FILES                                       DPSO7027
*     Q        - QUERY ????                                             DPSO7027
*     RELEASE | REL                                                     DPSO7027
*              - ?????                                                  DPSO7027
*     REFRESH | REF | R                                                 DPSO7027
*              - ?????                                                  DPSO7027
*     S | SE | SEND | SENDE                                             DPSO7027
*              - SEND BMS MAP                                           DPSO7027
*     SETBASE | SB                                                      DPSO7027
*              - ????                                                   DPSO7027
*     TCTUA    - TCT USER AREA FOR SPECIFIED TERMINAL                   DPSO7027
*     VERSION | VER                                                     DPSO7027
*              - RETURNS THE VERSION OF CICS                            DPSO7027
*                                                                       DPSO7027
*********************************************************************** DPSO7027
         MACRO
         COMMAND &CMD=,&LABEL=,&CSECT=,&OPTION=
*                                                  STRT MACRO COMMAND
         LCLA  &L                                                       DPSO7027
&L       SETA  K'&CMD
         AIF   (T'&OPTION EQ 'O').A1
         DC    AL1(&L),AL1(&OPTION),CL8'&CMD'
         AGO   .A2
.A1      ANOP
         DC    AL1(&L),AL1(0),CL8'&CMD'
.A2      ANOP
         DC    AL2(&LABEL-&CSECT),V(&CSECT)
*                                                  END  MACRO COMMAND
         MEND
         MACRO
         CMDVAR &R1,&R2,&R3,&LENIN,&OUT,&LENOUT
*                                                  STRT MACRO CMDVAR
         MVI   &OUT,X'40'
         MVC   &OUT+1(L'&OUT-1),&OUT
         XC    &LENOUT,&LENOUT
         LH    &R3,&LENIN
         LTR   &R3,&R3
         BZ    CVX&SYSNDX
         CLC   0(2,&R1),=C'X'''
         BNE   *+14
         OI    CMDSW,CONVERT
         LA    &R1,1(&R1)
         BCTR  &R3,0
         CLI   0(&R1),C''''
         BNE   *+14
         OI    CMDSW,DELIMIT
         LA    &R1,1(&R1)
         BCTR  &R3,0
         STH   &R3,&LENIN
         LA    &R2,&OUT
CV1&SYSNDX EQU *
         CLI   0(&R1),C' '
         BE    CV3&SYSNDX
         CLI   0(&R1),C'_'
         BE    CV3&SYSNDX
         CLI   0(&R1),C';'
         BE    CV3&SYSNDX
         TM    CMDSW,DELIMIT
         BNO   CV2&SYSNDX
         CLI   0(&R1),C''''
         BE    CV4&SYSNDX
CV2&SYSNDX EQU *
         MVC   0(1,&R2),0(&R1)
         LA    &R1,1(&R1)
         LA    &R2,1(&R2)
         BCT   &R3,CV1&SYSNDX
         B     CV5&SYSNDX
CV3&SYSNDX EQU *
         TM    CMDSW,DELIMIT
         BO    CV2&SYSNDX
         B     CV5&SYSNDX
CV4&SYSNDX EQU *
         LA    &R1,1(&R1)
         CLI   0(&R1),C''''
         BNE   CV5&SYSNDX
         B     CV2&SYSNDX
CV5&SYSNDX EQU *
         LA    &R3,&OUT
         SR    &R2,&R3
         STH   &R2,&LENOUT
         LH    &R2,&LENIN
         SH    &R2,&LENOUT
         TM    CMDSW,DELIMIT
         BNO   *+6
         BCTR  &R2,0
         STH   &R2,&LENIN
         TM    CMDSW,CONVERT
         BNO   CVX&SYSNDX
         LA    &R2,&OUT
         XC    WORKFLD,WORKFLD
         LA    &R3,WORKFLD
         CHR2HEX &R2,&R3,&LENOUT
         BNZ   P#CMD@E
CVC&SYSNDX EQU *
         LH    &R2,&LENOUT
         SRL   &R2,1
         STH   &R2,&LENOUT
         MVC   &OUT,WORKFLD
CVX&SYSNDX EQU *
         NI    CMDSW,X'FF'-(CONVERT+DELIMIT)
*                                                  END  MACRO CMDVAR
         MEND
         MACRO
         LEFT &R1,&LEN
*                                                  STRT MACRO LEFT
         LH    0,FLDLEN
LF1&SYSNDX EQU *
         CLI   0(&R1),C' '
         BE    LF2&SYSNDX
         CLI   0(&R1),C'_'
         BE    LF2&SYSNDX
         CLI   0(&R1),C';'
         BE    LF2&SYSNDX
         CLI   0(&R1),C'='
         BE    LF2&SYSNDX
         STH   0,FLDLEN
         B     LF3&SYSNDX
LF2&SYSNDX EQU *
         LA    &R1,1(&R1)
         BCT   0,LF1&SYSNDX                                             DPSO7027
         STH   0,FLDLEN                                                 DPSO7027
LF3&SYSNDX EQU *
*                                                  END  MACRO LEFT
         MEND
         MACRO
         LEFTC &R1,&LEN                                                 DPSO7027
*                                                  STRT MACRO LEFTC     DPSO7027
         LH    0,FLDLEN                                                 DPSO7027
         MVI   CMDEND,C'N'                                              DPSO7027
LF1&SYSNDX EQU *                                                        DPSO7027
         CLI   0(&R1),C' '                                              DPSO7027
         BE    LF3&SYSNDX                                               DPSO7027
         CLI   0(&R1),C'_'                                              DPSO7027
         BE    LF3&SYSNDX                                               DPSO7027
         CLI   0(&R1),C'='                                              DPSO7027
         BE    LF3&SYSNDX                                               DPSO7027
         CLI   0(&R1),C';'                                              DPSO7027
         BE    LF2&SYSNDX                                               DPSO7027
         STH   0,FLDLEN                                                 DPSO7027
         B     LF4&SYSNDX                                               DPSO7027
LF2&SYSNDX EQU *                                                        DPSO7027
         MVI   CMDEND,C'Y'                                              DPSO7027
LF3&SYSNDX EQU *                                                        DPSO7027
         LA    &R1,1(&R1)                                               DPSO7027
         BCT   0,LF1&SYSNDX                                             DPSO7027
         STH   0,FLDLEN                                                 DPSO7027
LF4&SYSNDX EQU *                                                        DPSO7027
*                                                  END  MACRO LEFTC     DPSO7027
         MEND                                                           DPSO7027
         MACRO                                                          DPSO7027
         CSR2MEM &BIN,&OFFSET,&OFFSET2                                  DPSO7027
*                                                  STRT MACRO CSR2MEM
         L     1,&BIN                                                   DPSO7027
         SH    1,=H'417'
         XR    0,0
         D     0,=F'80'
         MH    1,=H'16'
         LR    15,1
         LR    1,0
         XR    0,0
         D     0,=F'9'
         CH    1,=H'3'                                                  DPSO7027
         BNH   *+10                                                     DPSO7027
         LA    1,4                                                      DPSO7027
         XR    0,0                                                      DPSO7027
         MH    1,=H'4'
         AR    15,1
         ST    15,&OFFSET                                               DPSO7027
         SRL   0,1                                                      DPSO7027
         AR    15,0                                                     DPSO7027
         ST    15,&OFFSET2                                              DPSO7027
*                                                  END  MACRO CSR2MEM
         MEND
         MACRO
         BUMPCHN
*                                                  STRT MACRO BUMPCHN
         LH    15,CHAINNBR                                              DPSO7027
         CH    15,=Y(CHAINMAX)                                          DPSO7027
         BNL   *+12
         LA    15,1(15)
         STH   15,CHAINNBR                                              DPSO7027
         LH    15,CHAINIDX
         CH    15,=Y(CHAINMAX)                                          DPSO7027
         BL    *+8
         LA    15,0
         LA    15,1(15)
         STH   15,CHAINIDX
*                                                  END  MACRO BUMPCHN
         MEND
         MACRO
         BUMPNBR                                                        DPSO7027
*                                                  STRT MACRO BUMPNBR   DPSO7027
         LH    15,CHAINNBR                                              DPSO7027
         CH    15,=Y(CHAINMAX)                                          DPSO7027
         BNL   *+12                                                     DPSO7027
         LA    15,1(15)                                                 DPSO7027
         STH   15,CHAINNBR                                              DPSO7027
*                                                  END  MACRO BUMPNBR   DPSO7027
         MEND                                                           DPSO7027
         MACRO                                                          DPSO7027
         BUMPIDX                                                        DPSO7027
*                                                  STRT MACRO BUMPIDX   DPSO7027
         LH    15,CHAINIDX
         CH    15,=Y(CHAINMAX)                                          DPSO7027
         BL    *+8                                                      DPSO7027
         LA    15,0                                                     DPSO7027
         LA    15,1(15)                                                 DPSO7027
         STH   15,CHAINIDX                                              DPSO7027
*                                                  END  MACRO BUMPIDX   DPSO7027
         MEND                                                           DPSO7027
         MACRO                                                          DPSO7027
         NEXTCHNI
*                                                  STRT MACRO NEXTCHNI
         LH    15,CHAINIDX                                              DPSO7027
         CH    15,=Y(CHAINMAX)                                          DPSO7027
         BL    *+8
         LA    15,0
         LA    15,1(15)
         STH   15,CHAINIDX
*                                                  END  MACRO NEXTCHNI
         MEND
         MACRO
         PREVCHNI
*                                                  STRT MACRO PREVCHNI
         LH    15,CHAINIDX
         CH    15,=H'1'
         BH    *+8
         LA    15,CHAINMAX+1                                            DPSO7027
         BCTR  15,0
         STH   15,CHAINIDX
*                                                  END  MACRO PREVCHNI
         MEND
         MACRO
         BUMP &R1,&FROM                                                 DPSO7027
*                                                  STRT MACRO BUMP      DPSO7027
         GETCHN &R1                                                     DPSO7027
         CLC   0(4,&R1),&FROM                                           DPSO7027
         BE    BXMP&SYSNDX                                              DPSO7027
         NEXTCHN &R1                                                    DPSO7027
         OC    0(4,&R1),0(&R1)                                          DPSO7027
         MVC   0(4,&R1),&FROM                                           DPSO7027
         BNZ   BUMP&SYSNDX                                              DPSO7027
         BUMPNBR                                                        DPSO7027
BUMP&SYSNDX EQU *                                                       DPSO7027
         BUMPIDX                                                        DPSO7027
BXMP&SYSNDX EQU *                                                       DPSO7027
*                                                  END  MACRO BUMP      DPSO7027
         MEND                                                           DPSO7027
         MACRO                                                          DPSO7027
         GETCHN &R1                                                     DPSO7027
*                                                  STRT MACRO GETCHN    DPSO7027
         LH    &R1,CHAINIDX
         BCTR  &R1,0
         MH    &R1,=H'4'
         LA    &R1,CHAIN(&R1)
*                                                  END  MACRO GETCHN    DPSO7027
         MEND
         MACRO
         NEXTCHN &R1
*                                                  STRT MACRO NEXTCHN
         LH    &R1,CHAINIDX
         CH    &R1,=Y(CHAINMAX)                                         DPSO7027
         BL    *+8
         LA    &R1,0
         MH    &R1,=H'4'
         LA    &R1,CHAIN(&R1)
*                                                  END  MACRO NEXTCHN
         MEND
         MACRO
         PREVCHN &R1
*                                                  STRT MACRO PREVCHN
         LH    &R1,CHAINIDX
         CH    &R1,=H'1'
         BH    *+8
         LA    &R1,CHAINMAX+1                                           DPSO7027
         SH    &R1,=H'2'
         MH    &R1,=H'4'
         LA    &R1,CHAIN(&R1)
*                                                  END  MACRO PREVCHN
         MEND
         MACRO
         OUTSF &OUT,&ATTR
*                                                  STRT MACRO OUTSF
         MVI   0(&OUT),X'1D'
         LA    15,ATTR
         AH    15,ATTROFF
         CLI   0(15),X'00'
         BE    *+14
         MVC   1(1,&OUT),0(15)
         B     *+8
         MVI   1(&OUT),&ATTR
         LA    &OUT,2(&OUT)
*                                                  END  MACRO OUTSF
         MEND
         MACRO
         SETATTR &OUT,&ATTR
*                                                  STRT MACRO SETATTR
         LA    15,ATTR
         A     15,&OUT                                                  DPSO7027
         BCTR  15,0
         MVI   0(15),&ATTR
*                                                  END  MACRO SETATTR
         MEND
         MACRO
         HW2CHR &HW,&OUT
*                                                  STRT MACRO HW2CHR
         LA    15,&HW
         HEX2CHR 15,&OUT,2
*                                                  END  MACRO HW2CHR
         MEND
         MACRO
         FW2CHR &FW,&OUT                                                DPSO7027
*                                                  STRT MACRO FW2CHR    DPSO7027
         LA    15,&FW                                                   DPSO7027
         HEX2CHR 15,&OUT,4                                              DPSO7027
*                                                  END  MACRO FW2CHR    DPSO7027
         MEND                                                           DPSO7027
         MACRO                                                          DPSO7027
         HW2CHRN &HW,&OUT
*                                                  STRT MACRO HW2CHRN
         LH    15,&HW
         LTR   15,15
         BNM   HWN1&SYSNDX
         MVI   0(&OUT),C'-'                                             DPSO7027
         LA    &OUT,1(&OUT)
         MH    15,=H'-1'
         STH   15,HWNH&SYSNDX
         LA    15,HWNH&SYSNDX
         B     HWN2&SYSNDX
HWN1&SYSNDX EQU   *
         MVI   0(&OUT),X'00'
         LA    &OUT,1(&OUT)
         LA    15,&HW
HWN2&SYSNDX EQU   *
         HEX2CHR 15,&OUT,2
         B     HWNX&SYSNDX
HWNH&SYSNDX DS    H
HWNX&SYSNDX EQU   *
*                                                  END  MACRO HW2CHRN
         MEND
         MACRO
         FW2CHRN &FW,&OUT,&R1                                           DPSO7027
*                                                  STRT MACRO FW2CHRN   DPSO7027
         L     15,&FW                                                   DPSO7027
         LTR   15,15                                                    DPSO7027
         BNM   FWN1&SYSNDX                                              DPSO7027
         MVI   0(&OUT),C'-'                                             DPSO7027
         LA    &OUT,1(&OUT)                                             DPSO7027
         MH    15,=H'-1'                                                DPSO7027
         ST    15,FWNH&SYSNDX                                           DPSO7027
         LA    15,FWNH&SYSNDX                                           DPSO7027
         B     FWN2&SYSNDX                                              DPSO7027
FWN1&SYSNDX EQU   *                                                     DPSO7027
         MVI   0(&OUT),X'00'                                            DPSO7027
         LA    &OUT,1(&OUT)                                             DPSO7027
         LA    15,&FW                                                   DPSO7027
FWN2&SYSNDX EQU   *                                                     DPSO7027
         LA    &R1,FWNC&SYSNDX                                          DPSO7027
         HEX2CHR 15,&R1,4                                               DPSO7027
         MVC   0(5,&OUT),FWNC&SYSNDX+3                                  DPSO7027
         LA    &OUT,5(&OUT)                                             DPSO7027
         B     FWNX&SYSNDX                                              DPSO7027
FWNH&SYSNDX DS    F                                                     DPSO7027
FWNC&SYSNDX DS    CL8                                                   DPSO7027
FWNX&SYSNDX EQU   *                                                     DPSO7027
*                                                  END  MACRO FW2CHRN   DPSO7027
         MEND                                                           DPSO7027
         MACRO                                                          DPSO7027
         OUTREG &R1,&OUT
         GBLB  &ORF
         GBLC  &CS
*                                                  STRT MACRO OUTREG
         AIF   (&ORF).OR1
         B     *+8
RWORK&CS DS    AL4
&ORF     SETB  1
.OR1     ANOP
         STCM  &R1,B'1111',RWORK&CS
         LA    15,RWORK&CS
         HEX2CHR 15,&OUT,4
*                                                  END  MACRO OUTREG
         MEND
         MACRO
         OUTREGH &R1,&OUT
         GBLB  &ORHF
         GBLC  &CS
*                                                  STRT MACRO OUTREGH
         AIF   (&ORHF).ORH1
         B     *+6
RHWORK&CS DS    AL2
&ORHF    SETB  1
.ORH1    ANOP
         STCM  &R1,B'0011',RHWORK&CS
         LA    15,RHWORK&CS
         HEX2CHR 15,&OUT,2
*                                                  END  MACRO OUTREGH
         MEND
         MACRO
         HEX2DSP &IN,&OUT,&LEN
         GBLB  &H2DF
         GBLC  &CS
         LCLC  &S
*                                                  STRT MACRO HEX2DSP
         AIF   (&H2DF).H2D1
         B     *+260
H2DTR&CS DC    64X'4B'
         DC    X'404B4B4B4B4B4B4B4B4B4A4B4C4D4E4F'
         DC    X'504B4B4B4B4B4B4B4B4B5A5B5C5D5E5F'
         DC    X'60614B4B4B4B4B4B4B4B6A6B6C6D6E6F'
         DC    X'4B4B4B4B4B4B4B4B4B797A7B7C7D7E7F'
         DC    X'4B8182838485868788894B8B8C8D8E8F'
         DC    X'4B9192939495969798994B4B4B4B4B4B'
         DC    X'4B4BA2A3A4A5A6A7A8A9AA4B4B4B4B4B'
         DC    X'4B4B4B4B4B4B4B4B4B4B4B4B4B4B4B4B'
         DC    X'C0C1C2C3C4C5C6C7C8C94B4B4B4B4B4B'
         DC    X'D0D1D2D3D4D5D6D7D8D94B4B4B4B4B4B'
         DC    X'E0E1E2E3E4E5E6E7E8E94B4B4B4B4B4B'
         DC    X'F0F1F2F3F4F5F6F7F8F94B4B4B4B4B4B'
&H2DF    SETB  1
.H2D1    ANOP
&S       SETC  '(&OUT)'
         MVC   0(&LEN,&OUT),0(&IN)
         TR    0(&LEN,&OUT),H2DTR&CS
         LA    &OUT,&LEN&S
*                                                  END  MACRO HEX2DSP
         MEND
         MACRO
         HEX2CHR &IN,&OUT,&LEN
         GBLB  &H2CF
         GBLC  &CS
         LCLA  &L,&L2,&L3
         LCLC  &S
         LCLC  &S2
*                                                  STRT MACRO HEX2CHR
         AIF   (&H2CF).H2C1
         B     *+100
HWORK&CS DS    CL80
H2CTR&CS DC    X'F0F1F2F3F4F5F6F7F8F9C1C2C3C4C5C6'
&H2CF    SETB  1
.H2C1    ANOP
&L       SETA  &LEN*2
&L2      SETA  (&LEN*2)+2
&L3      SETA  &LEN+1
&S       SETC  '(&OUT)'
&S2      SETC  '(&L2)'
         UNPK  HWORK&CS&S2,0(&L3,&IN)
         TR    HWORK&CS&S2,H2CTR&CS-240
         MVC   0(&L,&OUT),HWORK&CS+1
         LA    &OUT,&L&S
*                                                  END  MACRO HEX2CHR
         MEND
         MACRO
         CHR2HEX &IN,&OUT,&LEN
         GBLB  &C2HF
         GBLC  &CS
         LCLC  &S
*                                                  STRT MACRO CHR2HEX
&S       SETC  '(*-*)'
         AIF   (&C2HF).C2H1
         B     *+404
CWORK&CS DS    CL80
CWORK2&CS DS    CL40
CHRT&CS  DC    64X'4B'
         DC    X'4B4B4B4B4B4B4B4B4B4B4B4B4B4B4B4B'
         DC    X'4B4B4B4B4B4B4B4B4B4B4B4B4B4B4B4B'
         DC    X'4B4B4B4B4B4B4B4B4B4B4B4B4B4B4B4B'
         DC    X'4B4B4B4B4B4B4B4B4B4B4B4B4B4B4B4B'
         DC    X'4BFAFBFCFDFEFF4B4B4B4B4B4B4B4B4B'
         DC    X'4B4B4B4B4B4B4B4B4B4B4B4B4B4B4B4B'
         DC    X'4B4B4B4B4B4B4B4B4B4B4B4B4B4B4B4B'
         DC    X'4B4B4B4B4B4B4B4B4B4B4B4B4B4B4B4B'
         DC    X'4BFAFBFCFDFEFF4B4B4B4B4B4B4B4B4B'
         DC    X'4B4B4B4B4B4B4B4B4B4B4B4B4B4B4B4B'
         DC    X'4B4B4B4B4B4B4B4B4B4B4B4B4B4B4B4B'
         DC    X'F0F1F2F3F4F5F6F7F8F94B4B4B4B4B4B'
&C2HF    SETB  1
CHRMOVE&CS MVC   CWORK&CS&S,0(&IN)
CHRTR&CS   TR    CWORK&CS&S,CHRT&CS
CHRPACK&CS PACK  CWORK2&CS&S,CWORK&CS&S
CHROUT&CS  MVC   0(*-*,&OUT),CWORK2&CS
.C2H1    ANOP
         TM    &LEN+1,X'01'
         BO    C2HE&SYSNDX
         LH    15,&LEN
         BCTR  15,0
         EX    15,CHRMOVE&CS
         EX    15,CHRTR&CS
         LH    0,&LEN
         LA    1,CWORK&CS
C2HV&SYSNDX EQU *
         CLI   0(1),X'4B'
         BE    C2HE&SYSNDX
         LA    1,1(1)
         BCT   0,C2HV&SYSNDX
         LH    1,&LEN
         SRL   1,1
         SLL   1,4
         AH    1,&LEN
         EX    1,CHRPACK&CS
         SRL   15,1
         EX    15,CHROUT&CS
         SR    1,1
         B     C2HX&SYSNDX
C2HE&SYSNDX EQU *
         MVC   EMSG,=CL78' '
         MVC   EMSG(16),=C'INVALID HEX DATA'
         LTR   1,1
C2HX&SYSNDX EQU *
*                                                  END  MACRO CHR2HEX
         MEND
         MACRO
         GETIN &IN,&LIN,&OUT,&LOUT,&SOUT
         GBLB  &GINF
         GBLC  &CS
*                                                  STRT MACRO GETIN
         AIF   (&GINF).GIN1
         B     *+266
GINTR&CS DC    17X'00'
         DC    X'11'
         DC    238X'00'
GINTRT&CS TRT   0(*-*,&IN),GINTR&CS
&GINF    SETB  1
.GIN1    ANOP
         LA    &IN,1(&IN)
         LR    1,&IN
         LA    15,&SOUT
         SBA2BIN 1,15
         LH    15,&LIN
         CH    15,=H'256'
         BNH   *+8
         LA    15,256
         SH    15,=H'2'
         EX    15,GINTRT&CS
         BNZ   *+30
         LA    &OUT,2(0,&IN)
         LA    &IN,1(15,&IN)
         SH    15,=H'1'
         STH   15,&LOUT
         XC    &LIN,&LIN
         B     *+32
         SR    1,&IN
         SR    15,1
         LA    15,1(15)
         STH   15,&LIN
         SH    1,=H'2'
         STH   1,&LOUT
         LA    &OUT,2(0,&IN)
         LA    &IN,2(1,&IN)
*                                                  END  MACRO GETIN
         MEND
         MACRO
         HW2DEC4 &IN,&OUT
         LCLC  &S
&S       SETC  '(4)'
*                                                  STRT MACRO HW2DEC4
         LH    15,&IN
         CVD   15,H2DP&SYSNDX
         UNPK  H2DZ&SYSNDX,H2DP&SYSNDX
         OI    H2DZ&SYSNDX+3,X'F0'
         MVC   &OUT&S,H2DZ&SYSNDX
         B     H2D1&SYSNDX
H2DZ&SYSNDX DS  CL4
H2DP&SYSNDX DS  D
H2D1&SYSNDX EQU *
*                                                  END  MACRO HW2DEC4
         MEND
         MACRO
         HW2DEC8 &IN,&OUT
         LCLC  &S
&S       SETC  '(8)'
*                                                  STRT MACRO HW2DEC8
         LH    15,&IN
         CVD   15,H2DP&SYSNDX
         UNPK  H2DZ&SYSNDX,H2DP&SYSNDX
         OI    H2DZ&SYSNDX+7,X'F0'
         MVC   &OUT&S,H2DZ&SYSNDX
         B     H2D1&SYSNDX
H2DZ&SYSNDX DS  CL8
H2DP&SYSNDX DS  D
H2D1&SYSNDX EQU *
*                                                  END  MACRO HW2DEC8
         MEND
         MACRO
         FW2DEC4 &IN,&OUT
         LCLC  &S
&S       SETC  '(4)'
*                                                  STRT MACRO FW2DEC4
         L     15,&IN
         CVD   15,F2DP&SYSNDX
         UNPK  F2DZ&SYSNDX,F2DP&SYSNDX
         OI    F2DZ&SYSNDX+3,X'F0'
         MVC   &OUT&S,F2DZ&SYSNDX
         B     F2D1&SYSNDX
F2DZ&SYSNDX DS  CL4
F2DP&SYSNDX DS  D
F2D1&SYSNDX EQU *
*                                                  END  MACRO FW2DEC4
         MEND
         MACRO
         FW2DEC8 &IN,&OUT
         LCLC  &S
&S       SETC  '(8)'
*                                                  STRT MACRO FW2DEC8
         L     15,&IN
         CVD   15,F2DP&SYSNDX
         UNPK  F2DZ&SYSNDX,F2DP&SYSNDX
         OI    F2DZ&SYSNDX+7,X'F0'
         MVC   &OUT&S,F2DZ&SYSNDX
         B     F2D1&SYSNDX
F2DZ&SYSNDX DS  CL8
F2DP&SYSNDX DS  D
F2D1&SYSNDX EQU *
*                                                  END  MACRO FW2DEC8
         MEND
         MACRO
         CURSOR &ROW,&COL,&OUT
*                                                  STRT MACRO CURSOR
         OUTSBA &ROW,&COL,&OUT
         MVI   0(&OUT),X'13'
         LA    &OUT,1(&OUT)
*                                                  END  MACRO CURSOR
         MEND
         MACRO
         CURSORX &ROW,&COL,&OUT
*                                                  STRT MACRO CURSORX
         LA    0,&ROW
         LA    15,&COL
         OUTSBA 0,15,&OUT
         MVI   0(&OUT),X'13'
         LA    &OUT,1(&OUT)
*                                                  END  MACRO CURSORX
         MEND
         MACRO
         OUTDATA &OUT,&DATA,&DATAL
         LCLC  &S
&S       SETC  '(&OUT)'
*                                                  STRT MACRO OUTDATA
         MVC   0(&DATAL,&OUT),&DATA
         LA    &OUT,&DATAL&S
*                                                  END  MACRO OUTDATA
         MEND
         MACRO
         OUTFLD &ROW,&COL,&OUT,&ATTR,&DATA,&DATAL
         LCLA   &L
         LCLC   &X
*                                                  STRT MACRO OUTFLD
         OUTSBA &ROW,&COL,&OUT
         OUTSF &OUT,&ATTR
         AIF   (T'&DATA EQ 'O').EXIT
&X       SETC  ''''
         AIF   ('&DATA'(1,1) EQ '&X').CONST
         AIF   (T'&DATAL EQ 'O').NOLEN
         OUTDATA &OUT,&DATA,&DATAL
         AGO   .EXIT
.NOLEN   ANOP
&L       SETA   L'&DATA
         OUTDATA &OUT,&DATA,&L
         AGO   .EXIT
.CONST   ANOP
         AIF   (T'&DATAL EQ 'O').LEN
         OUTDATA &OUT,=C&DATA,&DATAL
         AGO   .EXIT
.LEN     ANOP
&L       SETA  K'&DATA-2
         OUTDATA &OUT,=C&DATA,&L
.EXIT    ANOP
*                                                  END  MACRO OUTFLD
         MEND
         MACRO
         OUTFLDC &ROW,&COL,&OUT,&ATTR,&DATA,&DATAL
         LCLA   &L
         LCLC   &X
*                                                  STRT MACRO OUTFLDC
         OUTSBA &ROW,&COL,&OUT
         OUTSF &OUT,&ATTR
         MVI   0(&OUT),X'13'
         LA    &OUT,1(&OUT)
         AIF   (T'&DATA EQ 'O').EXIT
&X       SETC  ''''
         AIF   ('&DATA'(1,1) EQ '&X').CONST
         AIF   (T'&DATAL EQ 'O').NOLEN
         OUTDATA &OUT,&DATA,&DATAL
         AGO   .EXIT
.NOLEN   ANOP
&L       SETA   L'&DATA
         OUTDATA &OUT,&DATA,&L
         AGO   .EXIT
.CONST   ANOP
         AIF   (T'&DATAL EQ 'O').LEN
         OUTDATA &OUT,=C&DATA,&DATAL
         AGO   .EXIT
.LEN     ANOP
&L       SETA  K'&DATA-2
         OUTDATA &OUT,=C&DATA,&L
.EXIT    ANOP
*                                                  END  MACRO OUTFLDC
         MEND
         MACRO
         OUTFLDX &ROW,&COL,&OUT,&ATTR,&DATA,&DATAL
*                                                  STRT MACRO OUTFLDX
         LA    0,&ROW
         LA    15,&COL
         OUTFLD 0,15,&OUT,&ATTR,&DATA,&DATAL
*                                                  END  MACRO OUTFLDX
         MEND
         MACRO
         OUTFLDCX &ROW,&COL,&OUT,&ATTR,&DATA,&DATAL
*                                                  STRT MACRO OUTFLDCX
         LA    0,&ROW
         LA    15,&COL
         OUTFLDC 0,15,&OUT,&ATTR,&DATA,&DATAL
*                                                  END  MACRO OUTFLDCX
         MEND
         MACRO
         OUTSBA &ROW,&COL,&OUT
*                                                  STRT MACRO OUTSBA
         MVI   0(&OUT),X'11'
         LA    &OUT,1(&OUT)
         RC2SBA &ROW,&COL,&OUT
         LA    &OUT,2(&OUT)
*                                                  END  MACRO OUTSBA
         MEND
         MACRO
         RC2BIN &ROW,&COL,&BIN
*                                                  STRT MACRO RC2BIN
         LR    0,&ROW
         BCTR  0,0
         MH    0,=H'80'
         AR    0,&COL
         BCTR  0,0
         STH   0,0(&BIN)
*                                                  END  MACRO RC2BIN
         MEND
         MACRO
         BIN2RC &BIN,&ROW,&COL
*                                                  STRT MACRO BIN2RC
         L     1,&BIN                                                   DPSO7027
         XR    0,0
         D     0,=F'80'
         LR    &ROW,1
         LA    &ROW,1(&ROW)
         LR    &COL,0
*                                                  END  MACRO BIN2RC
         MEND
         MACRO
         RC2SBA &ROW,&COL,&SBA
*                                                  STRT MACRO RC2SBA
         RC2BIN &ROW,&COL,&SBA
         MVC   ATTROFF,0(&SBA)
         LH    0,0(&SBA)
         BIN2SBA 0,&SBA
*                                                  END  MACRO RC2SBA
         MEND
         MACRO
         BIN2SBA &R1,&R2
*                                                  STRT MACRO BIN2SBA
         GBLB  &B2SF
         GBLC  &CS
         AIF   (&B2SF).B2S1
         B     *+68
C3270$&CS DC    X'40C1C2C3C4C5C6C7C8C94A4B4C4D4E4F'
          DC    X'50D1D2D3D4D5D6D7D8D95A5B5C5D5E5F'
          DC    X'6061E2E3E4E5E6E7E8E96A6B6C6D6E6F'
          DC    X'F0F1F2F3F4F5F6F7F8F97A7B7C7D7E7F'
&B2SF    SETB  1
.B2S1    ANOP
         LR    0,&R1
         STC   0,1(&R2)
         SRL   0,6
         STC   0,0(&R2)
         NC    0(2,&R2),=2X'3F'
         TR    0(2,&R2),C3270$&CS
*                                                  END  MACRO BIN2SBA
         MEND
         MACRO
         SBA2BIN &R1,&R2
*                                                  STRT MACRO SBA2BIN
         MVC   0(2,&R2),0(&R1)
         NC    0(2,&R2),=2X'3F'
         XR    0,0
         IC    0,0(&R2)
         SLL   0,6
         MVI   0(&R2),0
         AH    0,0(&R2)
         ST    0,0(&R2)                                                 DPSO7027
*                                                  END  MACRO SBA2BIN
         MEND
         MACRO
         FRED1
DFHEISTG DSECT
SAVEAREA DS    18F                                                      DPSO7027
REG13    DS    F                                                        DPSO7027
*TMPARM   DS    4F
*  FIELDS FOR KPS0824 CALL
SAVE14   DS    F
SAVESUB1 DS    18F                     REGISTER SAVEAREA
*
KPS0824W DS    0F                      KPS0824 WORK AREA
PARM     DS    2F                      KPS0824 PARM POINTERS
PARMBLK  DS    (P824L)X                KPS0824 PARAMETER BLOCK
@SCR     DS    F
@CSA     DS    F
SAVE13   DS    F
CEMTPRMS EQU   *                                                        DPSO7027
CEMT1    DS    F                                                        DPSO7027
CEMT2    DS    F                                                        DPSO7027
CEMT3    DS    F                                                        DPSO7027
CEMT4    DS    F                                                        DPSO7027
CEMT5    DS    F                                                        DPSO7027
@CMD     DS    F                                                        DPSO7027
@TABLE   DS    F                      PRIMARY ADDR FROM KPS0824
@TABLE2  DS    F                      SECONDARY ADDR FROM KPS0824
SCRLEN   DS    H
OFFSET   DS    F                                                        DPSO7027
OFFSET2  DS    F                                                        DPSO7027
OFFSET3  DS    F                                                        DPSO7027
OFFSETX  DS    F                                                        DPSO7027
MEMOFF   DS    H
RECLEN   DS    H
FLDLEN   DS    H
ATTROFF  DS    H
TSQNAME  DS    0CL8                                                     DPSO7027
TSQID    DS    CL4                                                      DPSO7027
TSQTERM  DS    CL4                                                      DPSO7027
CEMTCMD  DS    CL70                                                     DPSO7027
NEWCMD   DS    CL70                                                     DPSO7027
APPLID   DS    CL8
TEMPCHR  DS    CL8                                                      DPSO7027
         DS    0F
COMM     EQU   *
RFADDR   DS    F
TSQDATA  EQU   *                                                        DPSO7027
OPSYS    DS    X                                                        DPSO7027
CEMTLOOP DS    X                                                        DPSO7027
CMDSW    DS    X
CONVERT  EQU   X'80'
DELIMIT  EQU   X'40'
JUSTSEND EQU   X'20'                                                    DPSO7027
NOERASE  EQU   X'10'                                                    DPSO7027
PASSWORD EQU   X'01'
VERIFIED EQU   X'02'
ABENDOFF EQU   X'04'                                                    DPSO7027
ADDRESS  DS    F
PADDRESS DS    F
COFFSET  DS    F                                                        DPSO7027
POFFSET  DS    F                                                        DPSO7027
CHAINMAX EQU   50                                                       DPSO7027
CHAINIDX DS    H
CHAINNBR DS    H                                                        DPSO7027
         DS    0F
CHAIN    DS    (CHAINMAX*4)X                                            DPSO7027
FINDLEN  DS    H
FINDSTR  DS    CL70
FINDSW   DS    X
REFIND   EQU   X'80'
ALLOWRF  EQU   X'40'                                                    DPSO7027
PECMDIDX DS    H                                                        DPSO7027
PECMDCX  DS    H                                                        DPSO7027
PECMDMX  EQU   30                                                       DPSO7027
PECMD    DS    (PECMDMX*70)X                                            DPSO7027
PECMDL   EQU   *-PECMDIDX                                               DPSO7027
TSQL     EQU   *-TSQDATA                                                DPSO7027
COMML    EQU   *-COMM
TSQRL    DS    H                                                        DPSO7027
CMDOUT   DS    CL70
CMDOLEN  DS    H
CMDLENSV DS    H
ECMD     DS    CL70
EOUTPUT  DS    CL11
EMSG     DS    CL78
EOUTPUTL EQU   *-EOUTPUT
ECURSOR  DS    CL4
ECMDOUT  DS    CL70
WORKFLD  DS    CL140
         ORG   WORKFLD
REQNAME  DS    CL8                     REQUEST'S NAME FOR KPS824 CALL
REQACTN  DS    CL4                     REQUEST'S ACTION FOR KPS824 CALL
         ORG
DSPSAVE  DS    18F
EDSP     DS    CL78
         SPACE 2
         MEND
         MACRO
         FRED
*        GBLB  &DFHEIMX                                                 DPSO6170
         GBLB  &B2SF,&H2CF,&H2DF,&ORF,&ORHF,&GINF,&C2HF,&MVS
         GBLC  &CS,&VERS
&MVS     SETB  0
*&DFHEIMX SETB  1                                                       DPSO6170
&VERS    SETC  'V01.0'
&B2SF    SETB  0
&H2CF    SETB  0
&H2DF    SETB  0
&GINF    SETB  0
&ORF     SETB  0
&ORHF    SETB  0
&C2HF    SETB  0
&CS      SETC  '0'
CSACBAR  EQU   13
TCTTEAR  EQU   2
PPTCBAR  EQU   2
EISCBAR  EQU   2                                                        DPSO7027
SYTCABAR EQU   2
TIOABAR  EQU   3
         SPACE 2
*        COPY DFHTCTTE
*        COPY DFHPPTDS
*        COPY DFHTIOA
*        DFHEIS                                                         DPSO7027
*<=====  DFHTM  MF=(D,PARMLIST)
*        COPY DFHCSADS                    GEN'D BY THE CICS@ MACRO
*        DFHAFCD TYPE=DSECT               GEN'D BY THE CICS@ MACRO
*        DFHTCA CICSYST=YES               GEN'D BY THE CICS@ MACRO
                                                                SPACE 1
         CICS@ (@@@,TCA),MF=L,LIST=NO
                                                                SPACE 1
*        PRINT OFF
         COPY DFHTCTTE
*        COPY DFHPPTDS
         DFHPPT  TYPE=DSECT,LIST=YES        GENERATE DSECT FOR PPT
         COPY DFHTIOA
         DFHEIS                                                         DPSO7027
         DFHTACB TYPE=DSECT                                             DPSO7027
         DFHAICB TYPE=DSECT
         EJECT
         COPY DFHAID
         EJECT
         COPY DFHBMSCA
         COPY KPW0825                     PARAMETER BLOCK FOR KPS0824
         PRINT ON
         EJECT
MSD      DSECT                         DFHMSD HEADER                    DPSO7027
MSDNAME  DS    CL8                     MAPSET NAME                      DPSO7027
MSDOVFLT DS    AL1                     OVERFLOW TRAILER LENGTH          DPSO7027
MSDVERS  DS    X                       VERSION                          DPSO7027
MSDLDC   DS    CL2                     LOGICAL DEVICE COMPONENT         DPSO7027
MSD#L    EQU   *-MSD                                                    DPSO7027
*                                      DESCRIPTOR FIELDS NOT PRESENT    DPSO7027
         SPACE 2                                                        DPSO7027
MDI      DSECT                         DFHMDI HEADER                    DPSO7027
MDIMDL   DS    AL2                     MAP DESCRIPTOR LENGTH            DPSO7027
MDIIPR   DS    XL2                     INPUT PARTITION NAME             DPSO7027
MDIOPR   DS    XL2                     OUTPUT PARTITION NAME            DPSO7027
MDIAPR   DS    XL2                     ACTIVE PARTITION NAME            DPSO7027
MDINAME  DS    CL8                     MAP NAME                         DPSO7027
MDIMAPL  DS    AL2                     MAP LENGTH                       DPSO7027
MDIMSL   DS    AL2                     MAP SPECIFICATION LENGTH         DPSO7027
MDIIWAL  DS    AL2                     INPUT WORK AREA LENGTH           DPSO7027
MDIOWAL  DS    AL2                     OUTPUT WORK AREA LENGTH          DPSO7027
MDIDFLAG DS    AL1                     MAP DESCRIPTOR FLAG BYTE         DPSO7027
MDIDFIO  EQU   X'C0'                   MODE = INOUT                     DPSO7027
MDIDFOUT EQU   X'80'                   MODE = OUT                       DPSO7027
MDIDFIN  EQU   X'40'                   MODE = IN                        DPSO7027
MDIDFOBF EQU   X'08'                   OBFMT = YES                      DPSO7027
MDIDFBLK EQU   X'01'                   DATA = BLOCK                     DPSO7027
MDIWCC   DS    CL1                     3270 WRITE CONTROL CHARACTER     DPSO7027
MDICPOSN DS    AL2                     3270 CURSOR POSITION             DPSO7027
MDIMARG  DS    AL1                     MAP MARGIN                       DPSO7027
MDILINES DS    AL1                     MAP LENGTH - NUMBER OF LINES     DPSO7027
MDICOLS  DS    AL1                     MAP WIDTH - NUMBER OF COLUMNS    DPSO7027
MDILINE1 DS    AL1                     MAP STARTING LINE NUMBER         DPSO7027
MDICOL1  DS    AL1                     MAP STARTING COLUMN NUMBER       DPSO7027
MDIIND   DS    AL1                     MAP INDICATOR                    DPSO7027
MDIISEQ  EQU   X'01'                   FIELDS NOT IN SEQUENCE           DPSO7027
MDIITRL  EQU   X'02'                   TRAILER = YES                    DPSO7027
MDIIHDR  EQU   X'04'                   HEADER = YES                     DPSO7027
MDIIALGN EQU   X'20'                   ALIGNED MAP                      DPSO7027
MDIIATTD EQU   X'40'                   EXTENDED ATTRIBUTES IN DSECT     DPSO7027
MDIIATTM EQU   X'80'                   EXTENDED ATTRIBUTES IN MAP       DPSO7027
MDIREQ2  DS    AL1                     TYPE REQUEST BYTE TWO            DPSO7027
MDIREQ3  DS    AL1                     TYPE REQUEST BYTE THREE          DPSO7027
MDIREQ4  DS    AL1                     TYPE REQUEST BYTE FOUR           DPSO7027
MDIREQ5  DS    AL1                     TYPE REQUEST BYTE FIVE           DPSO7027
MDIRQCPN DS    AL2                     REQUEST CURSOR POSITION          DPSO7027
MDIRQWCC DS    AL1                     REQUEST WRITE CONTROL CHARACTER  DPSO7027
MDIWRES  EQU   X'40'                   RESET FUNCTION                   DPSO7027
MDIWALRM EQU   X'04'                   SOUND ALARM                      DPSO7027
MDIWKBDR EQU   X'02'                   KEYBOARD RESTORE                 DPSO7027
MDIWMDTR EQU   X'01'                   MDT RESTORE                      DPSO7027
MDIMAXAT DS    AL1                     MAX NO OF ATTRS                  DPSO7027
MDICHAIN DS    AL4                     MAP CHAIN POINTER                DPSO7027
MDINATF  DS    AL2                     NO. OF ATTRS IN MAP FIELDS       DPSO7027
MDINATD  DS    AL2                     NO. OF ATTRS IN DSECT FIELDS     DPSO7027
MDIMAPAT DS    12AL1                   MAPATTS                          DPSO7027
MDIDSAT  DS    12AL1                   DSATTS                           DPSO7027
MDIFSEPL DS    AL1                     FIELD SEPARATOR LENGTH           DPSO7027
MDIFSEP  DS    XL4                     FIELD SEPARATOR VALUE            DPSO7027
MDI#L    EQU   *-MDI                                                    DPSO7027
         SPACE 2                                                        DPSO7027
MDF      DSECT                         DFHMDF ENTRY                     DPSO7027
MDFPGPOS DS    AL2                     PAGE POSITION                    DPSO7027
MDFLNG   DS    AL2                     FIELD LENGTH                     DPSO7027
MDFFLAG  DS    AL1                     FIELD DESCRIPTOR FLAG BYTE       DPSO7027
MDFFMX   EQU   X'80'                   MIXED CASE                       DPSO7027
MDFFPEN  EQU   X'10'                   ATTRB = DET                      DPSO7027
MDFFJZER EQU   X'08'                   JUSTIFY = ZERO                   DPSO7027
MDFFJRT  EQU   X'04'                   JUSTIFY = RIGHT                  DPSO7027
MDFFDFT  EQU   X'02'                   INITIAL = ANY                    DPSO7027
MDFFDSCT EQU   X'01'                   FLDNAME SPECIFIED                DPSO7027
MDFATTR  DS    CL1                     FIELD ATTRIBUTE                  DPSO7027
MDFAPROT EQU   X'20'                   PROTECTED                        DPSO7027
MDFANUM  EQU   X'10'                   NUMERIC                          DPSO7027
MDFADSYP EQU   X'04'                   DISPLAY / SELECTOR PEN DETECT    DPSO7027
MDFAIP   EQU   X'08'                   INTENSIFIED / SEL PEN DETECT     DPSO7027
MDFANN   EQU   X'0C'                   NONDISPLAY / NONPRINT / NONDET   DPSO7027
MDFAMDT  EQU   X'01'                   MODIFIED DATA TAG SET            DPSO7027
MDFFPOS  DS    AL2                     FIELD POSITION                   DPSO7027
MDFDTA   DS    0X                      INITIAL DATA                     DPSO7027
MDF#L    EQU   *-MDF                                                    DPSO7027
         SPACE 2                                                        DPSO7027
*        3270 BUFFER CONTROL ORDERS                                     DPSO7027
SF       EQU   X'1D'                   START FIELD        ... SF @      DPSO7027
SBA      EQU   X'11'                   SET BUFFER ADDRESS ... SBA X Y   DPSO7027
IC       EQU   X'13'                   INSERT CURSOR                    DPSO7027
PT       EQU   X'05'                   PROGRAM TAB                      DPSO7027
RA       EQU   X'3C'                   REPEAT TO ADDRESS  ... RA X Y C  DPSO7027
EUA      EQU   X'12'                   ERASE UNPROT TO ADDR . EUA X Y   DPSO7027
         SPACE 4                                                        DPSO7027
ATTRTAB  DSECT
ATTR     DS    X
         SPACE 4
CMDTABDS DSECT
CMDLEN   DS    X
CMDPARMS DS    X
PARMS    EQU   X'80'
CMDID    DS    CL8
CMDOFF   DS    H
CMDCSECT DS    F
CMDTABL  EQU   *-CMDTABDS
         SPACE 4
AIDTABDS DSECT
AIDTABKY DS    X
         DS    3X                                                       DPSO7027
AIDTABOF DS    V                                                        DPSO7027
AIDTABL  EQU   *-AIDTABDS
         SPACE 4
*
KPS1127  DFHEIENT CODEREG=(7),DATAREG=(8),EIBREG=(9)
*<=====  ST    13,@CSA
*<=====  ST    13,CSA@                                                  DPSO7027
                                                                SPACE 1
         CICS@ CSA,BASE=2,USING=NO,CSA@=@CSA
         ST    2,CSA@
         MVI   ECMD,C'_'
         MVC   ECMD+1(L'ECMD-1),ECMD
         MVC   TSQID,EIBTRNID                                           DPSO7027
         MVC   TSQTERM,EIBTRMID                                         DPSO7027
         EXEC CICS GETMAIN SET(10) LENGTH(=H'1920') INITIMG(X'00')
         USING ATTRTAB,10
         OC    EIBTRMID,EIBTRMID                                        DPSO7027
         BZ    NOCOMM
         CLC   EIBCALEN,=Y(COMML)                                       DPSO7027
         BNE   NOCOMM                                                   DPSO7027
         LA    2,COMM                                                   DPSO7027
         LH    3,=Y(COMML)                                              DPSO7027
         LR    5,3                                                      DPSO7027
         EXEC CICS ADDRESS COMMAREA (4)                                 DPSO6170
*        L     4,DFHEICAP                                               DPSO6170
         MVCL  2,4                                                      DPSO7027
         TM    CMDSW,ABENDOFF                                           DPSO7027
         BO    NOABEND                                                  DPSO7027
         EXEC CICS HANDLE ABEND LABEL(ABENDED)                          DPSO7027
NOABEND  EQU   *                                                        DPSO7027
         TM    CMDSW,JUSTSEND                                           DPSO7027
         BNO   KEYTEST                                                  DPSO7027
         NI    CMDSW,X'FF'-JUSTSEND                                     DPSO7027
         L     15,=V(DISPLAY)                                           DPSO7027
         BR    15                                                       DPSO7027
KEYTEST  EQU   *                                                        DPSO7027
         LA    3,AIDTAB                                                 DPSO7027
         USING AIDTABDS,3                                               DPSO7027
         LA    4,AIDTABN                                                DPSO7027
KEYLOOP  EQU   *                                                        DPSO7027
         CLC   AIDTABKY,EIBAID                                          DPSO7027
         BNE   *+10                                                     DPSO7027
         L     2,AIDTABOF                                               DPSO7027
         BR    2                                                        DPSO7027
         LA    3,AIDTABL(3)                                             DPSO7027
         BCT   4,KEYLOOP                                                DPSO7027
         OC    EIBCALEN,EIBCALEN
         BZ    NOCOMM@X                                                 DPSO7027
         EXEC CICS RECEIVE SET(3) LENGTH(RECLEN)
GETFIELD EQU   *
         OC    RECLEN,RECLEN
         BZ    REDISP                                                   DPSO7027
         GETIN  3,RECLEN,4,FLDLEN,OFFSET
         OC    FLDLEN,FLDLEN
         BZ    GETFIELD                                                 DPSO7027
         CLC   OFFSET,=F'161'                                           DPSO7027
         BE    COMMAND
         CLC   OFFSET,=F'320'                                           DPSO7027
         BH    CHGMEM
         B     GETFIELD
COMMAND  EQU   *
         ST    13,REG13
         LA    13,SAVEAREA
         L     15,=V(CMDS)
         AIF   (&MVS).MVS1
         BALR  14,15
         AGO   .MVS2
.MVS1    ANOP
         BASR  14,15
.MVS2    ANOP
         L     13,REG13
         L     15,=V(DISPLAY)
         BR    15
CHGMEM   EQU   *
         TM    CMDSW,VERIFIED                                           DPSO7027
         BNO   CHGMEM@E                                                 DPSO7027
         CSR2MEM OFFSET,OFFSET2,OFFSET3                                 DPSO7027
         L     5,ADDRESS
         A     5,OFFSET2                                                DPSO7027
         A     5,COFFSET                                                DPSO7027
         CHR2HEX 4,5,FLDLEN
         BNZ   CHGMEM@Z                                                 DPSO7027
         SETATTR OFFSET,DFHBMBRY
         MVI   EIBAID,DFHENTER
         B     GETFIELD
CHGMEM@E EQU   *
         SETATTR OFFSET,DFHBMBRY                                        DPSO7027
         MVC   EMSG,=CL78' '
         MVC   EMSG(36),=C'CANNOT CHANGE MEMORY IN DISPLAY MODE'        DPSO7027
         L     15,=V(DISPLAY)                                           DPSO7027
         BR    15                                                       DPSO7027
CHGMEM@Z EQU   *                                                        DPSO7027
         BIN2RC OFFSET,2,3
         LA    5,EOUTPUT
         OUTFLDC 2,3,5,DFHUNIMD
         OUTFLDX 4,1,5,DFHBMASB
         EXEC CICS SEND FROM(EOUTPUT) LENGTH(=Y(EOUTPUTL))
         EXEC CICS RETURN TRANSID(EIBTRNID) COMMAREA(COMM)             X
               LENGTH(=Y(COMML))
         EJECT
ABENDED  EQU   *
         AIF   (&MVS).MVS3
         BALR  7,0
         AGO   .MVS4
.MVS3    ANOP
         BASR  7,0
.MVS4    ANOP
         LA    15,*-KPS1127
         SR    7,15
         MVC   ADDRESS,PADDRESS
         MVC   COFFSET,POFFSET
         MVI   EMSG,C' '                                                DPSO7027
         MVC   EMSG+1(L'EMSG-1),EMSG                                    DPSO7027
         MVC   EMSG(9),=C'ABENDED -'                                    DPSO7027
         CICS@ TCA,BASE=TCACBAR,USING=NO TCA(U) @
         L     SYTCABAR,TCASYAA                                         DPSO7027
         USING DFHTCADY,SYTCABAR                                        DPSO7027
         L     3,TCAPCACB                                               DPSO7027
         USING DFHABND,3                                                DPSO7027
         MVC   EMSG+10(4),ABNDCODE                                      DPSO7027
         LA    4,EMSG+15                                                DPSO7027
         HW2CHR ABNDPSW,4                                               DPSO7027
         HW2CHR ABNDPSW+2,4                                             DPSO7027
         LA    4,1(4)                                                   DPSO7027
         HW2CHR ABNDPSW+4,4                                             DPSO7027
         HW2CHR ABNDPSW+6,4                                             DPSO7027
         LA    4,1(4)                                                   DPSO7027
         HW2CHR ABNDINT,4                                               DPSO7027
         HW2CHR ABNDINT+2,4                                             DPSO7027
         LA    4,1(4)                                                   DPSO7027
         HW2CHR ABNDINT+4,4                                             DPSO7027
         HW2CHR ABNDINT+6,4                                             DPSO7027
         LA    4,EMSG+62                                                DPSO7027
         HW2CHR ABNDREGS+4,4                                            DPSO7027
         HW2CHR ABNDREGS+6,4                                            DPSO7027
         PREVCHNI                                                       DPSO7027
         CLI   OPSYS,C'E'                                               DPSO7027
         BE    *+28                                                     DPSO7027
         L     5,16                                                     DPSO7027
         L     5,0(5)                                                   DPSO7027
         L     5,4(5)                                                   DPSO7027
         L     5,X'D0'(5)                                               DPSO7027
         L     5,X'14'(5)                                               DPSO7027
         B     *+12                                                     DPSO7027
         L     5,X'14'                                                  DPSO7027
         L     5,X'B4'(5)                                               DPSO7027
         USING DFHAFCB,5                                                DPSO7027
         L     5,AFAICB                 @ OF @ EIQ (USED BY DFHEI1)     DPSO7027
         DROP  15                                                       DPSO7027
         USING DFHAICB,5                                                DPSO7027
         L     6,DFHAIEXC               @ EIQ                           DPSO7027
*        L     1,=V(TRAP)               GET @ TRAP ROUTINE              DPSO6170
*        CR    1,6                      TRAP ALREADY SET ?              DPSO6170
*        BNE   RESET                                                    DPSO6170
         B     RESET                                                    DPSO6170
         L     15,=V(SAVEIQ)                                            DPSO7027
         MVC   DFHAIEXC,0(15)                                           DPSO7027
         XC    0(4,15),0(15)                                            DPSO7027
         EXEC CICS RELEASE PROGRAM('KPS1127')                           DPSO7027
RESET    EQU   *                                                        DPSO7027
         NI    FINDSW,X'FF'-(ALLOWRF+REFIND)                            DPSO7027
         EXEC CICS HANDLE ABEND RESET
         L     15,=V(DISPLAY)
         BR    15
         SPACE 4
REDISP   EQU   *                                                        DPSO7027
         L     15,=V(DISPLAY)                                           DPSO7027
         BR    15                                                       DPSO7027
NOCOMM   EQU   *
         MVC   TSQRL,=Y(TSQL)                                           DPSO7027
         MVC   TSQITEM,=Y(1)                                            DPSO7027
         EXEC CICS READQ QUEUE(TSQNAME) INTO(TSQDATA)                  XDPSO7027
               LENGTH(TSQRL) ITEM(TSQITEM) NOHANDLE                     DPSO7027
         CLC   EIBRESP,DFHRESP(NORMAL)                                  DPSO7027
         BE    NOCOMM@1                                                 DPSO7027
         ST    13,ADDRESS
         ST    13,CHAIN
         MVC   CHAINIDX,=H'1'
         MVC   CHAINNBR,=H'1'                                           DPSO7027
         OI    CMDSW,VERIFIED                                           DPSO7027
         EXEC CICS INQUIRE SYSTEM OPSYS(OPSYS)                          DPSO7027
NOCOMM@1 EQU   *                                                        DPSO7027
         CLC   EIBTRNID,=C'CSTP'                                        DPSO7027
         BNE   NOCOMM@2                                                 DPSO7027
         MVC   FLDLEN,=H'7'                                             DPSO7027
         LA    4,CSTPCMD                                                DPSO7027
         B     NOCOMM@R                                                 DPSO7027
CSTPCMD  DC    CL70'CEMTON;'                                            DPSO7027
NOCOMM@2 EQU   *                                                        DPSO7027
         OC    EIBTRMID,EIBTRMID                                        DPSO7027
         BZ    NOCOMM@3                                                 DPSO7027
         TM    CMDSW,ABENDOFF                                           DPSO7027
         BO    NOCOMM@3                                                 DPSO7027
         EXEC CICS HANDLE ABEND LABEL(ABENDED)                          DPSO7027
NOCOMM@3 EQU   *                                                        DPSO7027
         OC    EIBCALEN,EIBCALEN                                        DPSO7027
         BZ    NOCOMM@4                                                 DPSO7027
*        EXEC CICS ADDRESS COMMAREA (4)                                 DPSO6170
*        L     4,DFHEICAP                                               DPSO6170
         MVC   FLDLEN,EIBCALEN                                          DPSO7027
         B     NOCOMM@R                                                 DPSO7027
NOCOMM@4 EQU   *                                                        DPSO7027
         EXEC CICS RETRIEVE SET(4) LENGTH(FLDLEN) NOHANDLE              DPSO7027
         CLC   EIBRESP,DFHRESP(NORMAL)                                  DPSO7027
         B     NOCOMM@R                                                 DPSO6170
*        BE    NOCOMM@R                                                 DPSO6170
         L     TCTTEAR,TCAFCAAA
         USING DFHTCTTE,TCTTEAR
         SLL   TCTTEAR,8
         SRL   TCTTEAR,8
         L     TIOABAR,TCTTEDA
         USING DFHTIOA,TIOABAR                                          DPSO7027
         LTR   TIOABAR,TIOABAR
         BZ    KEYTEST                                                  DPSO7027
         SLL   TIOABAR,8
         SRL   TIOABAR,8
         LH    1,TIOATDL
         LTR   1,1
         BZ    KEYTEST                                                  DPSO7027
         LA    4,TIOADBA
         CLI   0(4),X'11'
         BNE   *+12
         LA    4,3(4)
         SH    1,=H'3'
         LA    4,4(4)
         SH    1,=H'4'
         LTR   1,1
         BZ    KEYTEST                                                  DPSO7027
         STH   1,FLDLEN
NOCOMM@R EQU   *                                                        DPSO7027
         MVC   OFFSET,=F'161'                                           DPSO7027
         ST    13,REG13
         LA    13,SAVEAREA
         L     15,=V(CMDS)
         AIF   (&MVS).MVS5
         BALR  14,15
         AGO   .MVS6
.MVS5    ANOP
         BASR  14,15
.MVS6    ANOP
         L     13,REG13
NOCOMM@X EQU   *
         L     15,=V(DISPLAY)
         BR    15
         SPACE 4
         EJECT
         ENTRY RETURNC                                                  DPSO7027
RETURNC  EQU   *
         AIF   (&MVS).MVSK1                                             DPSO7027
         BALR  7,0                                                      DPSO7027
         AGO   .MVSK2                                                   DPSO7027
.MVSK1   ANOP                                                           DPSO7027
         BASR  7,0                                                      DPSO7027
.MVSK2   ANOP                                                           DPSO7027
         LA    15,*-KPS1127                                             DPSO7027
         SR    7,15                                                     DPSO7027
         MVC   PECMDCX,PECMDIDX                                         DPSO7027
         MVC   TSQITEM,=Y(1)                                            DPSO7027
         EXEC CICS WRITEQ TS QUEUE(TSQNAME) ITEM(TSQITEM)              XDPSO7027
               FROM(TSQDATA) LENGTH(=Y(TSQL)) REWRITE MAIN NOHANDLE     DPSO7027
         CLC   EIBRESP,DFHRESP(NORMAL)                                  DPSO7027
         BE    RETURNCX                                                 DPSO7027
         EXEC CICS WRITEQ TS QUEUE(TSQNAME) ITEM(TSQITEM)              XDPSO7027
               FROM(TSQDATA) LENGTH(=Y(TSQL)) MAIN NOHANDLE             DPSO7027
RETURNCX EQU   *                                                        DPSO7027
         EXEC CICS RETURN
TSQITEM  DS    H                                                        DPSO7027
WASAVKY  DS    XL50                                                     DPSO7027
         ENTRY CSA@                                                     DPSO7027
CSA@     DS    F                                                        DPSO7027
         SPACE 3
AIDTAB   DS    0F                                                       DPSO7027
         DC    AL1(DFHCLEAR),AL3(0),V(RETURNC)                          DPSO7027
         DC    AL1(DFHPF2),AL3(0),V(P#PF2)                              DPSO7027
         DC    AL1(DFHPF3),AL3(0),V(P#PF3)                              DPSO7027
         DC    AL1(DFHPF4),AL3(0),V(P#PF4)                              DPSO7027
         DC    AL1(DFHPF5),AL3(0),V(P#PF5)                              DPSO7027
         DC    AL1(DFHPF6),AL3(0),V(P#PF6)                              DPSO7027
         DC    AL1(DFHPF7),AL3(0),V(P#PF7)                              DPSO7027
         DC    AL1(DFHPF8),AL3(0),V(P#PF8)                              DPSO7027
         DC    AL1(DFHPF9),AL3(0),V(P#PF9)                              DPSO7027
         DC    AL1(DFHPF10),AL3(0),V(P#PF10)                            DPSO7027
         DC    AL1(DFHPF11),AL3(0),V(P#PF11)                            DPSO7027
         DC    AL1(DFHPF12),AL3(0),V(P#PF12)                            DPSO7027
         DC    AL1(DFHPF14),AL3(0),V(P#PF2)                             DPSO7027
         DC    AL1(DFHPF15),AL3(0),V(RETURNC)                           DPSO7027
         DC    AL1(DFHPF16),AL3(0),V(P#PF16)                            DPSO7027
         DC    AL1(DFHPF17),AL3(0),V(P#PF5)                             DPSO7027
         DC    AL1(DFHPF18),AL3(0),V(P#PF18)                            DPSO7027
         DC    AL1(DFHPF19),AL3(0),V(P#PF7)                             DPSO7027
         DC    AL1(DFHPF20),AL3(0),V(P#PF8)                             DPSO7027
         DC    AL1(DFHPF21),AL3(0),V(P#PF21)                            DPSO7027
         DC    AL1(DFHPF22),AL3(0),V(P#PF22)                            DPSO7027
         DC    AL1(DFHPF23),AL3(0),V(P#PF23)                            DPSO7027
         DC    AL1(DFHPF24),AL3(0),V(P#PF24)                            DPSO7027
AIDTABN  EQU   (*-AIDTAB)/AIDTABL                                       DPSO7027
         LTORG                                                          DPSO7027
         EJECT                                                          DPSO7027
         MEND                                                           DPSO7027
         MACRO                                                          DPSO7027
         FRED8                                                          DPSO7027
         GBLB  &B2SF,&H2CF,&H2DF,&ORF,&ORHF,&GINF,&C2HF,&MVS            DPSO7027
         GBLC  &CS,&VERS                                                DPSO7027
PFKEYS   CSECT                                                          DPSO7027
&B2SF    SETB  0                                                        DPSO7027
&H2CF    SETB  0                                                        DPSO7027
&H2DF    SETB  0                                                        DPSO7027
&GINF    SETB  0                                                        DPSO7027
&ORF     SETB  0                                                        DPSO7027
&ORHF    SETB  0                                                        DPSO7027
&C2HF    SETB  0                                                        DPSO7027
&CS      SETC  '8'                                                      DPSO7027
         USING *,7                                                      DPSO7027
         ENTRY P#PF2                                                    DPSO7027
P#PF2    EQU   *                                                        DPSO7027
         AIF   (&MVS).MVSP1                                             DPSO7027
         BALR  7,0                                                      DPSO7027
         AGO   .MVSP2                                                   DPSO7027
.MVSP1   ANOP                                                           DPSO7027
         BASR  7,0                                                      DPSO7027
.MVSP2   ANOP                                                           DPSO7027
         LA    15,*-PFKEYS                                              DPSO7027
         SR    7,15                                                     DPSO7027
         NI    CMDSW,X'FF'-VERIFIED                                     DPSO7027
         L     15,=V(DISPLAY)
         BR    15
         SPACE 3                                                        DPSO7027
         ENTRY P#PF3                                                    DPSO7027
P#PF3    EQU   *                                                        DPSO7027
         AIF   (&MVS).MVSP100                                           DPSO7027
         BALR  7,0                                                      DPSO7027
         AGO   .MVSP101                                                 DPSO7027
.MVSP100 ANOP                                                           DPSO7027
         BASR  7,0                                                      DPSO7027
.MVSP101 ANOP                                                           DPSO7027
         LA    15,*-PFKEYS                                              DPSO7027
         SR    7,15                                                     DPSO7027
         EXEC CICS SEND CONTROL ERASE                                   DPSO7027
         L     15,=V(RETURNC)                                           DPSO7027
         BR    15                                                       DPSO7027
         SPACE 3                                                        DPSO7027
         ENTRY P#PF4                                                    DPSO7027
P#PF4    EQU   *                                                        DPSO7027
         AIF   (&MVS).MVSP3                                             DPSO7027
         BALR  7,0                                                      DPSO7027
         AGO   .MVSP4                                                   DPSO7027
.MVSP3   ANOP                                                           DPSO7027
         BASR  7,0                                                      DPSO7027
.MVSP4   ANOP                                                           DPSO7027
         LA    15,*-PFKEYS                                              DPSO7027
         SR    7,15                                                     DPSO7027
         OC    PECMDIDX,PECMDIDX                                        DPSO7027
         BNZ   P#PF4@1                                                  DPSO7027
         MVC   EMSG,=CL78' '
         MVC   EMSG(23),=C'NO COMMANDS TO RETRIEVE'                     DPSO7027
         B     P#PF4@X                                                  DPSO7027
P#PF4@1  EQU   *                                                        DPSO7027
         LH    2,PECMDCX                                                DPSO7027
         CH    2,=H'0'                                                  DPSO7027
         BH    *+8                                                      DPSO7027
         LA    2,PECMDMX                                                DPSO7027
         BCTR  2,0                                                      DPSO7027
         STH   2,PECMDCX                                                DPSO7027
         MH    2,=Y(L'ECMD)                                             DPSO7027
         LA    2,PECMD(2)                                               DPSO7027
         OC    0(L'ECMD,2),0(2)                                         DPSO7027
         BNZ   P#PF4@2                                                  DPSO7027
         MVC   EMSG,=CL78' '
         MVC   EMSG(28),=C'NO MORE COMMANDS TO RETRIEVE'                DPSO7027
         MVC   PECMDCX,PECMDIDX                                         DPSO7027
         B     P#PF4@X                                                  DPSO7027
P#PF4@2  EQU   *                                                        DPSO7027
         MVC   ECMD,0(2)                                                DPSO7027
         MVC   OFFSET,=F'161'                                           DPSO7027
         SETATTR OFFSET,DFHBMFSE                                        DPSO7027
         LA    6,ECURSOR                                                DPSO7027
         CURSORX 3,2,6                                                  DPSO7027
P#PF4@X  EQU   *                                                        DPSO7027
         L     15,=V(DISPLAY)                                           DPSO7027
         BR    15                                                       DPSO7027
         SPACE 3                                                        DPSO7027
         ENTRY P#PF5                                                    DPSO7027
P#PF5    EQU   *
         AIF   (&MVS).MVSP5                                             DPSO7027
         BALR  7,0                                                      DPSO7027
         AGO   .MVSP6                                                   DPSO7027
.MVSP5   ANOP                                                           DPSO7027
         BASR  7,0                                                      DPSO7027
.MVSP6   ANOP                                                           DPSO7027
         LA    15,*-PFKEYS                                              DPSO7027
         SR    7,15                                                     DPSO7027
         TM    FINDSW,ALLOWRF                                           DPSO7027
         BNO   P#PF5@1                                                  DPSO7027
         ST    13,PREG13                                                DPSO7027
         LA    13,PSVAREA                                               DPSO7027
         OI    FINDSW,REFIND
         L     15,=V(CMDS)
         AIF   (&MVS).MVS7
         BALR  14,15
         AGO   .MVS8
.MVS7    ANOP
         BASR  14,15
.MVS8    ANOP
         L     13,PREG13                                                DPSO7027
         B     P#PF5@2                                                  DPSO7027
P#PF5@1  EQU   *                                                        DPSO7027
         MVC   EMSG,=CL78' '
         MVC   EMSG(18),=C'ENTER FIND COMMAND'                          DPSO7027
P#PF5@2  EQU   *                                                        DPSO7027
         L     15,=V(DISPLAY)
         BR    15
         SPACE 3
         ENTRY P#PF6                                                    DPSO7027
P#PF6    EQU   *                                                        DPSO7027
         AIF   (&MVS).MVSP7                                             DPSO7027
         BALR  7,0                                                      DPSO7027
         AGO   .MVSP8                                                   DPSO7027
.MVSP7   ANOP                                                           DPSO7027
         BASR  7,0                                                      DPSO7027
.MVSP8   ANOP                                                           DPSO7027
         LA    15,*-PFKEYS                                              DPSO7027
         SR    7,15                                                     DPSO7027
         LA    2,PECMDIDX                                               DPSO7027
         LA    3,PECMDL                                                 DPSO7027
         XR    4,4                                                      DPSO7027
         XR    5,5                                                      DPSO7027
         MVCL  2,4                                                      DPSO7027
         L     15,=V(DISPLAY)
         BR    15
         SPACE 3
         ENTRY P#PF7                                                    DPSO7027
P#PF7    EQU   *
         AIF   (&MVS).MVSP9                                             DPSO7027
         BALR  7,0                                                      DPSO7027
         AGO   .MVSP10                                                  DPSO7027
.MVSP9   ANOP                                                           DPSO7027
         BASR  7,0                                                      DPSO7027
.MVSP10  ANOP                                                           DPSO7027
         LA    15,*-PFKEYS                                              DPSO7027
         SR    7,15                                                     DPSO7027
         LH    1,EIBCPOSN                                               DPSO7027
         ST    1,OFFSET2                                                DPSO7027
         CSR2MEM OFFSET2,OFFSET,OFFSET3                                 DPSO7027
         L     1,OFFSET3                                                DPSO7027
         CH    1,=H'0'                                                  DPSO7027
         BL    P#PF7@1                                                  DPSO7027
         CH    1,=H'256'                                                DPSO7027
         BH    P#PF7@1                                                  DPSO7027
         L     2,COFFSET                                                DPSO7027
         SH    2,=H'240'                                                DPSO7027
         AR    1,2                                                      DPSO7027
         B     P#PF7@2                                                  DPSO7027
P#PF7@1  EQU   *                                                        DPSO7027
         L     1,COFFSET                                                DPSO7027
         SH    1,=H'256'
P#PF7@2  EQU   *                                                        DPSO7027
         ST    1,COFFSET                                                DPSO7027
         L     1,ADDRESS
         A     1,COFFSET                                                DPSO7027
         GETCHN 2                                                       DPSO7027
         ST    1,0(2)
         L     15,=V(DISPLAY)
         BR    15
         SPACE 3
         ENTRY P#PF8                                                    DPSO7027
P#PF8    EQU   *
         AIF   (&MVS).MVSP11                                            DPSO7027
         BALR  7,0                                                      DPSO7027
         AGO   .MVSP12                                                  DPSO7027
.MVSP11  ANOP                                                           DPSO7027
         BASR  7,0                                                      DPSO7027
.MVSP12  ANOP                                                           DPSO7027
         LA    15,*-PFKEYS                                              DPSO7027
         SR    7,15                                                     DPSO7027
         LH    1,EIBCPOSN                                               DPSO7027
         ST    1,OFFSET2                                                DPSO7027
         CSR2MEM OFFSET2,OFFSET,OFFSET3                                 DPSO7027
         L     1,OFFSET3                                                DPSO7027
         CH    1,=H'0'                                                  DPSO7027
         BL    P#PF8@1                                                  DPSO7027
         CH    1,=H'256'                                                DPSO7027
         BH    P#PF8@1                                                  DPSO7027
         L     2,COFFSET                                                DPSO7027
         AR    1,2                                                      DPSO7027
         B     P#PF8@2                                                  DPSO7027
P#PF8@1  EQU   *                                                        DPSO7027
         L     1,COFFSET                                                DPSO7027
         A     1,=F'256'                                                DPSO7027
P#PF8@2  EQU   *                                                        DPSO7027
         ST    1,COFFSET                                                DPSO7027
         L     1,ADDRESS
         A     1,COFFSET                                                DPSO7027
         GETCHN 2                                                       DPSO7027
         ST    1,0(2)
         L     15,=V(DISPLAY)
         BR    15
         SPACE 3
         ENTRY P#PF9                                                    DPSO7027
P#PF9    EQU   *
         AIF   (&MVS).MVSP13                                            DPSO7027
         BALR  7,0                                                      DPSO7027
         AGO   .MVSP14                                                  DPSO7027
.MVSP13  ANOP                                                           DPSO7027
         BASR  7,0                                                      DPSO7027
.MVSP14  ANOP                                                           DPSO7027
         LA    15,*-PFKEYS                                              DPSO7027
         SR    7,15                                                     DPSO7027
*        DFHAFCD TYPE=LOCATE,REG=1                                      DPSO7027
*        USING DFHAFCB,1                                                DPSO7027
         MVC   ADDRESS,@CSA                                             DPSO7027
         BUMP 1,ADDRESS                                                 DPSO7027
         XC    COFFSET,COFFSET
         L     15,=V(DISPLAY)                                           DPSO7027
         BR    15                                                       DPSO7027
         SPACE 3                                                        DPSO7027
         ENTRY P#PF10                                                   DPSO7027
P#PF10   EQU   *
         AIF   (&MVS).MVSP15                                            DPSO7027
         BALR  7,0                                                      DPSO7027
         AGO   .MVSP16                                                  DPSO7027
.MVSP15  ANOP                                                           DPSO7027
         BASR  7,0                                                      DPSO7027
.MVSP16  ANOP                                                           DPSO7027
         LA    15,*-PFKEYS                                              DPSO7027
         SR    7,15                                                     DPSO7027
         PREVCHN 1
         OC    0(4,1),0(1)
         BZ    P#PF10@X
         PREVCHNI
         MVC   ADDRESS,0(1)
         XC    COFFSET,COFFSET
P#PF10@X EQU   *
         L     15,=V(DISPLAY)
         BR    15
         SPACE 3
         ENTRY P#PF11                                                   DPSO7027
P#PF11   EQU   *
         AIF   (&MVS).MVSP17                                            DPSO7027
         BALR  7,0                                                      DPSO7027
         AGO   .MVSP18                                                  DPSO7027
.MVSP17  ANOP                                                           DPSO7027
         BASR  7,0                                                      DPSO7027
.MVSP18  ANOP                                                           DPSO7027
         LA    15,*-PFKEYS                                              DPSO7027
         SR    7,15                                                     DPSO7027
         NEXTCHN 1
         OC    0(4,1),0(1)
         BZ    P#PF11@X
         MVC   ADDRESS,0(1)
         NEXTCHNI
         XC    COFFSET,COFFSET
P#PF11@X EQU   *
         L     15,=V(DISPLAY)
         BR    15
         SPACE 3
         ENTRY P#PF12                                                   DPSO7027
P#PF12   EQU   *
         AIF   (&MVS).MVSP19                                            DPSO7027
         BALR  7,0                                                      DPSO7027
         AGO   .MVSP20                                                  DPSO7027
.MVSP19  ANOP                                                           DPSO7027
         BASR  7,0                                                      DPSO7027
.MVSP20  ANOP                                                           DPSO7027
         LA    15,*-PFKEYS                                              DPSO7027
         SR    7,15                                                     DPSO7027
         LH    1,EIBCPOSN                                               DPSO7027
         ST    1,OFFSET2                                                DPSO7027
         CSR2MEM OFFSET2,OFFSET,OFFSET3                                 DPSO7027
         L     1,OFFSET                                                 DPSO7027
         CH    1,=H'0'
         BL    P#PF12@X
         CH    1,=H'256'
         BH    P#PF12@X
         L     1,ADDRESS
         A     1,COFFSET                                                DPSO7027
         A     1,OFFSET                                                 DPSO7027
         MVC   ADDRESS,0(1)
*<=====  MVI   ADDRESS,X'00'           24 BIT ADDRESSING
         NI    ADDRESS,X'FF'-X'80'     31 BIT ADDRESSING
         BUMP 1,ADDRESS                                                 DPSO7027
         XC    COFFSET,COFFSET
P#PF12@X EQU   *
         L     15,=V(DISPLAY)
         BR    15
         SPACE 3
         ENTRY P#PF16                                                   DPSO7027
P#PF16   EQU   *                                                        DPSO7027
         AIF   (&MVS).MVSP21                                            DPSO7027
         BALR  7,0                                                      DPSO7027
         AGO   .MVSP22                                                  DPSO7027
.MVSP21  ANOP                                                           DPSO7027
         BASR  7,0                                                      DPSO7027
.MVSP22  ANOP                                                           DPSO7027
         LA    15,*-PFKEYS                                              DPSO7027
         SR    7,15                                                     DPSO7027
         OC    PECMDIDX,PECMDIDX                                        DPSO7027
         BNZ   P#PF16@1                                                 DPSO7027
         MVC   EMSG,=CL78' '
         MVC   EMSG(23),=C'NO COMMANDS TO RETRIEVE'                     DPSO7027
         B     P#PF16@X                                                 DPSO7027
P#PF16@1 EQU   *                                                        DPSO7027
         LH    2,PECMDCX                                                DPSO7027
         CH    2,=Y(PECMDMX-1)                                          DPSO7027
         BL    *+8                                                      DPSO7027
         LH    2,=H'-1'                                                 DPSO7027
         LA    2,1(2)                                                   DPSO7027
         STH   2,PECMDCX                                                DPSO7027
         MH    2,=Y(L'ECMD)                                             DPSO7027
         LA    2,PECMD(2)                                               DPSO7027
         OC    0(L'ECMD,2),0(2)                                         DPSO7027
         BNZ   P#PF16@2                                                 DPSO7027
         MVC   EMSG,=CL78' '
         MVC   EMSG(28),=C'NO MORE COMMANDS TO RETRIEVE'                DPSO7027
         MVC   PECMDCX,PECMDIDX                                         DPSO7027
         B     *+10                                                     DPSO7027
P#PF16@2 EQU   *                                                        DPSO7027
         MVC   ECMD,0(2)                                                DPSO7027
         MVC   OFFSET,=F'161'                                           DPSO7027
         SETATTR OFFSET,DFHBMFSE                                        DPSO7027
         LA    6,ECURSOR                                                DPSO7027
         CURSORX 3,2,6                                                  DPSO7027
P#PF16@X EQU   *                                                        DPSO7027
         L     15,=V(DISPLAY)                                           DPSO7027
         BR    15                                                       DPSO7027
         SPACE 3                                                        DPSO7027
         ENTRY P#PF18                                                   DPSO7027
P#PF18   EQU   *                                                        DPSO7027
         AIF   (&MVS).MVSP23                                            DPSO7027
         BALR  7,0                                                      DPSO7027
         AGO   .MVSP24                                                  DPSO7027
.MVSP23  ANOP                                                           DPSO7027
         BASR  7,0                                                      DPSO7027
.MVSP24  ANOP                                                           DPSO7027
         LA    15,*-PFKEYS                                              DPSO7027
         SR    7,15                                                     DPSO7027
         LA    2,TSQDATA+1                                              DPSO7027
         LA    3,TSQL-1                                                 DPSO7027
         XR    4,4                                                      DPSO7027
         XR    5,5                                                      DPSO7027
         MVCL  2,4                                                      DPSO7027
         MVC   ADDRESS,@CSA                                             DPSO7027
         MVC   CHAIN(4),@CSA                                            DPSO7027
         MVC   CHAINIDX,=H'1'                                           DPSO7027
         MVC   CHAINNBR,=H'1'                                           DPSO7027
         L     15,=V(DISPLAY)                                           DPSO7027
         BR    15                                                       DPSO7027
         SPACE 3                                                        DPSO7027
         ENTRY P#PF21                                                   DPSO7027
P#PF21   EQU   *                                                        DPSO7027
         AIF   (&MVS).MVSP25                                            DPSO7027
         BALR  7,0                                                      DPSO7027
         AGO   .MVSP26                                                  DPSO7027
.MVSP25  ANOP                                                           DPSO7027
         BASR  7,0                                                      DPSO7027
.MVSP26  ANOP                                                           DPSO7027
         LA    15,*-PFKEYS                                              DPSO7027
         SR    7,15                                                     DPSO7027
         L     1,ADDRESS                                                DPSO7027
         A     1,COFFSET                                                DPSO7027
         ST    1,ADDRESS                                                DPSO7027
         GETCHN 2                                                       DPSO7027
         ST    1,0(2)                                                   DPSO7027
         XC    COFFSET,COFFSET                                          DPSO7027
         L     15,=V(DISPLAY)                                           DPSO7027
         BR    15                                                       DPSO7027
         SPACE 3                                                        DPSO7027
         ENTRY P#PF22                                                   DPSO7027
P#PF22   EQU   *                                                        DPSO7027
         AIF   (&MVS).MVSP29                                            DPSO7027
         BALR  7,0                                                      DPSO7027
         AGO   .MVSP30                                                  DPSO7027
.MVSP29  ANOP                                                           DPSO7027
         BASR  7,0                                                      DPSO7027
.MVSP30  ANOP                                                           DPSO7027
         LA    15,*-PFKEYS                                              DPSO7027
         SR    7,15                                                     DPSO7027
         CLC   EIBCPOSN,=H'400'                                         DPSO7027
         BL    P#PF22@7                                                 DPSO7027
         LH    3,EIBCPOSN                                               DPSO7027
         XR    2,2                                                      DPSO7027
         D     2,=F'80'                                                 DPSO7027
         SH    3,=H'5'                                                  DPSO7027
         LH    1,CHAINNBR                                               DPSO7027
         CH    1,=H'13'                                                 DPSO7027
         BNL   P#PF22@1                                                 DPSO7027
         LA    1,1                                                      DPSO7027
         B     P#PF22@5                                                 DPSO7027
P#PF22@1 EQU   *                                                        DPSO7027
         LH    1,CHAINIDX                                               DPSO7027
         CH    1,=H'13'                                                 DPSO7027
         BNL   P#PF22@4                                                 DPSO7027
         CLC   CHAINNBR,=Y(CHAINMAX)                                    DPSO7027
         BE    P#PF22@2                                                 DPSO7027
         LA    1,1                                                      DPSO7027
         B     P#PF22@5                                                 DPSO7027
P#PF22@2 EQU   *                                                        DPSO7027
         LA    1,CHAINMAX(1)                                            DPSO7027
P#PF22@4 EQU   *                                                        DPSO7027
         SH    1,=H'12'                                                 DPSO7027
P#PF22@5 EQU   *                                                        DPSO7027
         AR    1,3                                                      DPSO7027
         CH    1,CHAINNBR                                               DPSO7027
         BNH   *+8                                                      DPSO7027
         LH    1,CHAINNBR                                               DPSO7027
         STH   1,CHAINIDX                                               DPSO7027
         B     P#PF22@7                                                 DPSO7027
P#PF22@6 EQU   *                                                        DPSO7027
         MVC   CHAINIDX,=H'1'                                           DPSO7027
P#PF22@7 EQU   *                                                        DPSO7027
         GETCHN 1                                                       DPSO7027
         MVC   ADDRESS,0(1)                                             DPSO7027
         XC    COFFSET,COFFSET                                          DPSO7027
P#PF22@X EQU   *                                                        DPSO7027
         L     15,=V(DISPLAY)                                           DPSO7027
         BR    15                                                       DPSO7027
         SPACE 3                                                        DPSO7027
         ENTRY P#PF23                                                   DPSO7027
P#PF23   EQU   *                                                        DPSO7027
         AIF   (&MVS).MVSP31                                            DPSO7027
         BALR  7,0                                                      DPSO7027
         AGO   .MVSP32                                                  DPSO7027
.MVSP31  ANOP                                                           DPSO7027
         BASR  7,0                                                      DPSO7027
.MVSP32  ANOP                                                           DPSO7027
         LA    15,*-PFKEYS                                              DPSO7027
         SR    7,15                                                     DPSO7027
         MVC   CHAINIDX,CHAINNBR                                        DPSO7027
         GETCHN 1                                                       DPSO7027
         MVC   ADDRESS,0(1)                                             DPSO7027
         XC    COFFSET,COFFSET                                          DPSO7027
P#PF23@X EQU   *                                                        DPSO7027
         L     15,=V(DISPLAY)                                           DPSO7027
         BR    15                                                       DPSO7027
         SPACE 3                                                        DPSO7027
         ENTRY P#PF24                                                   DPSO7027
P#PF24   EQU   *
         AIF   (&MVS).MVSP27                                            DPSO7027
         BALR  7,0                                                      DPSO7027
         AGO   .MVSP28                                                  DPSO7027
.MVSP27  ANOP                                                           DPSO7027
         BASR  7,0                                                      DPSO7027
.MVSP28  ANOP                                                           DPSO7027
         LA    15,*-PFKEYS                                              DPSO7027
         SR    7,15                                                     DPSO7027
         LH    1,EIBCPOSN                                               DPSO7027
         ST    1,OFFSET2                                                DPSO7027
         CSR2MEM OFFSET2,OFFSET,OFFSET3                                 DPSO7027
         L     1,OFFSET                                                 DPSO7027
         CH    1,=H'0'
         BL    P#PF24@X
         CH    1,=H'256'
         BH    P#PF24@X
         L     1,ADDRESS
         A     1,COFFSET                                                DPSO7027
         A     1,OFFSET                                                 DPSO7027
         MVC   ADDRESS,0(1)
         MVI   ADDRESS,X'00'           24 BIT ADDRESSING
*<=====  NI    ADDRESS,X'FF'-X'80'     31 BIT ADDRESSING
         BUMP 1,ADDRESS                                                 DPSO7027
         XC    COFFSET,COFFSET
P#PF24@X EQU   *
         L     15,=V(DISPLAY)
         BR    15
         SPACE 3
PREG13   DS    F                                                        DPSO7027
PSVAREA  DS    18F                                                      DPSO7027
         LTORG
         EJECT
         MEND
         MACRO
         FRED2
         GBLB  &B2SF,&H2CF,&H2DF,&ORF,&ORHF,&GINF,&C2HF,&MVS
         GBLC  &CS,&VERS
DISPLAY  CSECT
&B2SF    SETB  0
&H2CF    SETB  0
&H2DF    SETB  0
&GINF    SETB  0
&ORF     SETB  0
&ORHF    SETB  0
&C2HF    SETB  0
&CS      SETC  '1'
         AIF   (&MVS).MVS9
         BALR  7,0
         AGO   .MVS10
.MVS9    ANOP
         BASR  7,0
.MVS10   ANOP
         USING *,7
         OC    EIBTRMID,EIBTRMID                                        DPSO7027
         BZ    DRETURN                                                  DPSO7027
         LA    13,DSPSAVE
         LA    6,ATTR
         DROP  10
         USING ATTRTAB,6
         EXEC CICS GETMAIN SET(3) LENGTH(MAXLEN) INITIMG(X'00')
         ST    3,@SCR
         OC    ECURSOR,ECURSOR
         BZ    *+18
         MVC   0(4,3),ECURSOR
         LA    3,4(3)
         B     DISP@1
         CURSORX 3,2,3
         B     DISP@1
DATE     DS    CL8
TIME     DS    CL8
TEST1    DS    CL4                                                      DPSO7027
TEST2    DS    CL4                                                      DPSO7027
TITLE    DS    CL14                                                     DPSO7027
DISP@1   EQU   *
         OUTFLDX 1,1,3,DFHBMASK,EIBTRNID,4
         TM    CMDSW,VERIFIED                                           DPSO7027
         BNO   *+14                                                     DPSO7027
         MVC   TITLE,=CL14' ACCESS MEMORY'                              DPSO7027
         B     *+10                                                     DPSO7027
         MVC   TITLE,=CL14'DISPLAY MEMORY'                              DPSO7027
         OUTFLDX 1,27,3,DFHBMASB,TITLE,14                               DPSO7027
         EXEC CICS ASSIGN APPLID(APPLID)
         EXEC CICS ASKTIME ABSTIME(ABSTIME)
         EXEC CICS FORMATTIME ABSTIME(ABSTIME) TIME(TIME) TIMESEP      X
               DDMMYY(DATE) DATESEP('/')
*        HW2DEC4 CHAINIDX,TEST1                                         DPSO7027
*        OUTFLDX 1,50,3,DFHBMASK,TEST1,4                                DPSO7027
*        HW2DEC4 CHAINNBR,TEST2                                         DPSO7027
*        OUTFLDX 2,50,3,DFHBMASK,TEST2,4                                DPSO7027
         OUTFLDX 1,62,3,DFHBMASK,APPLID,8
         OUTFLDX 2,62,3,DFHBMASK,EIBTRMID,4
         OUTFLDX 1,71,3,DFHBMASK,DATE,8
         OUTFLDX 2,71,3,DFHBMASK,TIME,8
         TM    CMDSW,PASSWORD
         BNO   DISP@2
         OUTFLDX 3,1,3,DFHBMDAR,ECMD,70
         B     DISP@3
DISP@2   EQU   *
         OUTFLDX 3,1,3,DFHBMUNP,ECMD,70
DISP@3   EQU   *
         OUTSF  3,DFHBMASK
         OUTFLDX 4,1,3,DFHBMASB,EMSG,78
         L     1,ADDRESS
         OC    COFFSET,COFFSET
         BZ    DISP@4
         OUTFLDX 5,1,3,DFHBMASB
         OUTREG 1,3
         B     DISP@5
DISP@4   EQU   *
         OUTFLDX 5,1,3,X'7C'
DISP@5   EQU   *
         OUTFLDX 5,71,3,DFHBMASK,'CHAIN'
         SPACE 3
         A     1,COFFSET                                                DPSO7027
         LR    2,1
         LA    4,6
         MVC   OFFSET,COFFSET
         LA    10,16
LP1      EQU   *
         LA    5,1
         OUTFLD 4,5,3,DFHBMASK
         OUTREG 1,3
         LA    5,10
         OUTFLD 4,5,3,DFHBMASB
         FW2CHRN OFFSET,3,11                                            DPSO7027
         LA    11,4
         LA    5,17
LP2      EQU   *
         OUTFLD 4,5,3,DFHBMUNP
LP2@2    EQU   *
         HEX2CHR 2,3,4
         OUTSF 3,X'F0'
         LA    5,9(5)
         LA    2,4(2)
         BCT   11,LP2
         LA    5,1(5)
         OUTFLD 4,5,3,DFHBMASK
         HEX2DSP 1,3,16
         LA    1,16(1)
         LA    4,1(4)
         L     11,OFFSET                                                DPSO7027
         A     11,=F'16'                                                DPSO7027
         ST    11,OFFSET                                                DPSO7027
         BCT   10,LP1
         L     15,=V(SENDPFK)
         BR    15
         SPACE 3
DRETURN  EQU   *                                                        DPSO7027
         EXEC CICS RETURN                                               DPSO7027
MAXLEN   DC    Y(3000)                                                  DPSO7027
ABSTIME  DS    D
         LTORG
         EJECT
         MEND
         MACRO
         FRED3
         GBLB  &B2SF,&H2CF,&H2DF,&ORF,&ORHF,&GINF,&C2HF,&MVS
         GBLC  &CS,&VERS
SENDPFK  CSECT
&B2SF    SETB  0
&H2CF    SETB  0
&H2DF    SETB  0
&GINF    SETB  0
&ORF     SETB  0
&ORHF    SETB  0
&C2HF    SETB  0
&CS      SETC  '2'
         SPACE 4
         STM   14,12,12(13)
         AIF   (&MVS).MVS11
         BALR  7,0
         AGO   .MVS12
.MVS11   ANOP
         BASR  7,0
.MVS12   ANOP
         USING *,7
         LA    4,6
         LH    1,CHAINNBR                                               DPSO7027
         CH    1,=H'13'                                                 DPSO7027
         BNL   CHAINI1                                                  DPSO7027
         LA    1,1                                                      DPSO7027
         B     CHAINI5                                                  DPSO7027
CHAINI1  EQU   *                                                        DPSO7027
         LH    1,CHAINIDX                                               DPSO7027
         CH    1,=H'13'                                                 DPSO7027
         BNL   CHAINI4                                                  DPSO7027
         CLC   CHAINNBR,=Y(CHAINMAX)                                    DPSO7027
         BE    CHAINI2                                                  DPSO7027
         LA    1,1                                                      DPSO7027
         B     CHAINI5                                                  DPSO7027
CHAINI2  EQU   *                                                        DPSO7027
         LA    1,CHAINMAX(1)                                            DPSO7027
CHAINI4  EQU   *                                                        DPSO7027
         SH    1,=H'12'                                                 DPSO7027
CHAINI5  EQU   *                                                        DPSO7027
         LR    2,1                                                      DPSO7027
         BCTR  1,0                                                      DPSO7027
         MH    1,=H'4'                                                  DPSO7027
         LA    1,CHAIN(1)                                               DPSO7027
         LA    10,16
CHAINLP  EQU   *
         LA    5,71
         CH    2,=Y(CHAINMAX)                                           DPSO7027
         BNH   *+12                                                     DPSO7027
         LA    2,1                                                      DPSO7027
         LA    1,CHAIN
         CH    2,CHAINIDX
         BE    CHAIN1
         OUTFLD 4,5,3,DFHBMASK
         B     CHAIN2
CHAIN1   EQU   *
         OUTFLD 4,5,3,DFHBMASB
CHAIN2   EQU   *
         OC    0(4,1),0(1)
         BZ    CHAIN3
         HEX2CHR 1,3,4
         B     CHAIN4
CHAIN3   EQU   *
         MVC   0(4,3),=CL4' '
         OUTSF 3,X'7C'                                                  DPSO7027
CHAIN4   EQU   *
         LA    1,4(1)
         LA    4,1(4)
         LA    2,1(2)                                                   DPSO7027
         BCT   10,CHAINLP
         SPACE 3
PFKS     EQU   *
         OUTFLDX 22,01,3,DFHBMASB,EDSP,78
         OUTFLDX 23,01,3,DFHBMASB,'CLEAR'
         OUTFLDX 23,07,3,DFHBMASK,'TO EXIT'
         OUTFLDX 23,21,3,DFHBMASB,'PF5'
         OUTFLDX 23,27,3,DFHBMASK,'FIND ANOTHER'
         OUTFLDX 23,41,3,DFHBMASB,'PF7'
         OUTFLDX 23,47,3,DFHBMASK,'BACKWARD'
         OUTFLDX 23,61,3,DFHBMASB,'PF8'
         OUTFLDX 23,67,3,DFHBMASK,'FORWARD'
         OUTFLDX 24,01,3,DFHBMASB,'PF9'
         OUTFLDX 24,07,3,DFHBMASK,'CSA ADDRESS'
         OUTFLDX 24,21,3,DFHBMASB,'PF10'
         OUTFLDX 24,27,3,DFHBMASK,'UP CHAIN'
         OUTFLDX 24,41,3,DFHBMASB,'PF11'
         OUTFLDX 24,47,3,DFHBMASK,'DOWN CHAIN'
         OUTFLDX 24,61,3,DFHBMASB,'PF12'
         OUTFLDX 24,67,3,DFHBMASK,'LOAD ADDRESS'
         MVI   EDSP,C' '
         MVC   EDSP+1(L'EDSP-1),EDSP
         S     3,@SCR
         STH   3,SCRLEN
         L     3,@SCR
         MVC   PADDRESS,ADDRESS
         MVC   POFFSET,COFFSET
         TM    CMDSW,NOERASE                                            DPSO7027
         BNO   SENDNC                                                   DPSO7027
         EXEC CICS SEND FROM(0(3)) LENGTH(SCRLEN)
         EXEC CICS RETURN TRANSID(EIBTRNID) COMMAREA(COMM)             X
               LENGTH(=Y(COMML))
SENDNC   EQU   *
         OI    CMDSW,NOERASE                                            DPSO7027
         EXEC CICS SEND FROM(0(3)) LENGTH(SCRLEN) ERASE
         EXEC CICS RETURN TRANSID(EIBTRNID) COMMAREA(COMM)             X
               LENGTH(=Y(COMML))
         LTORG
         EJECT
         MEND
         MACRO
         FRED4
         GBLB  &B2SF,&H2CF,&H2DF,&ORF,&ORHF,&GINF,&C2HF,&MVS
         GBLC  &CS,&VERS
CMDS     CSECT
&B2SF    SETB  0
&H2CF    SETB  0
&H2DF    SETB  0
&GINF    SETB  0
&ORF     SETB  0
&ORHF    SETB  0
&C2HF    SETB  0
&CS      SETC  '3'
         SPACE 3
         STM   14,12,12(13)
         AIF   (&MVS).MVS13
         BALR  7,0
         AGO   .MVS14
.MVS13   ANOP
         BASR  7,0
.MVS14   ANOP
         USING *,7
CMDBASE  EQU   *
         USING ATTRTAB,10
         TM    FINDSW,REFIND
         BO    P#FIND@0
         LA    3,CMDTAB
         USING CMDTABDS,3
         LEFT  4,FLDLEN
         OC    FLDLEN,FLDLEN                                            DPSO7027
         BZ    P#CMD@X                                                  DPSO7027
         TM    CMDSW,PASSWORD
         BNO   CMDSTACK                                                 DPSO7027
*        NC    0(7,4),TEMP1                                             DPSO7027
*        OC    0(7,4),TEMP2                                             DPSO7027
         CLC   0(7,4),CMDID
         BE    *+14
         MVC   0(7,4),=CL7' '
         B     P#CMD@E
         NI    CMDSW,X'FF'-PASSWORD
         OI    CMDSW,VERIFIED
         MVI   ECMD,C'_'
         MVC   ECMD+1(L'ECMD-1),ECMD
         B     P#CMD@X
CMDSTACK EQU   *                                                        DPSO7027
         LH    2,PECMDIDX                                               DPSO7027
         MH    2,=Y(L'ECMD)                                             DPSO7027
         LA    2,PECMD(2)                                               DPSO7027
         MVI   0(2),C'_'                                                DPSO7027
         MVC   1(L'ECMD-1,2),0(2)                                       DPSO7027
         LH    5,FLDLEN                                                 DPSO7027
         BCTR  5,0                                                      DPSO7027
         EX    5,PECMDMV                                                DPSO7027
         MVC   CEMTCMD,0(2)                                             DPSO7027
         LH    2,PECMDIDX                                               DPSO7027
         LA    2,1(2)                                                   DPSO7027
         CH    2,=Y(PECMDMX)                                            DPSO7027
         BL    *+6                                                      DPSO7027
         XR    2,2                                                      DPSO7027
         STH   2,PECMDIDX                                               DPSO7027
         STH   2,PECMDCX                                                DPSO7027
         B     CMDSTRT                                                  DPSO7027
PECMDMV  MVC   0(*-*,2),0(4)                                            DPSO7027
CMDSTRT  EQU   *
         ST    4,@CMD                                                   DPSO7027
         MVC   CMDLENSV,FLDLEN
         LA    15,CMDLENSV                                              DPSO7027
         XR    6,6
         LA    3,CMDTAB
         USING CMDTABDS,3
         LA    5,CMDTABN
CMDLOOP  EQU   *
         IC    6,CMDLEN
         BCTR  6,0
         EX    6,CMDCOMP
         BNE   CMDBUMP
         LA    11,1(6,4)
         CLI   0(11),C' '
         BE    CMDAUTH
         CLI   0(11),C'='
         BE    CMDAUTH
         CLI   0(11),C';'
         BE    CMDAUTH
         CLI   0(11),C'_'
         BE    CMDAUTH
         CLI   0(11),X'00'
         BE    CMDAUTH
         B     CMDBUMP
CMDAUTH  EQU   *
         TM    CMDPARMS,VERIFIED
         BNO   CMDPROC
         TM    CMDSW,VERIFIED
         BO    CMDPROC
         MVC   EMSG,=CL78' '
         MVC   EMSG(34),=C'NOT AVAILABLE IN DISPLAY ONLY MODE'          DPSO7027
         B     P#CMD@E                                                  DPSO7027
CMDPROC  EQU   *
         LH    5,FLDLEN
         LA    6,1(6)
         LA    4,0(6,4)
         SR    5,6
         STH   5,FLDLEN
         TM    CMDPARMS,PARMS
         BNO   CMDGO
         LEFT  4,FLDLEN
CMDGET   EQU   *                                                        DPSO7027
         CMDVAR 4,2,5,FLDLEN,CMDOUT,CMDOLEN
         OC    CMDOLEN,CMDOLEN
         BZ    CMDERR
CMDGO    EQU   *
         L     15,CMDCSECT
         AH    15,CMDOFF
         BR    15
CMDBUMP  EQU   *
         LA    3,CMDTABL(3)
         BCT   5,CMDLOOP
CMDERR   EQU   *
         MVC   EMSG,=CL78' '
         MVC   EMSG(15),=C'INVALID COMMAND'
         B     P#CMD@E
         SPACE 4
P#CMD    EQU   *
P#FIND   EQU   *
         OI    FINDSW,ALLOWRF                                           DPSO7027
         MVC   FINDSTR,CMDOUT
         MVC   FINDLEN,CMDOLEN
         L     1,ADDRESS
         A     1,COFFSET                                                DPSO7027
         ST    1,RFADDR
P#FIND@0 EQU   *
         L     1,RFADDR
         LH    2,FINDLEN
         BCTR  2,0
         L     3,=F'65536'
P#FIND@1 EQU   *
         EX    2,CMDFIND
         BE    P#FIND@2
         LA    1,1(1)
         BCT   3,P#FIND@1
         ST    1,RFADDR
         MVC   EMSG,=CL78' '
         MVC   EMSG(25),=C'SEARCH ARGUMENT NOT FOUND'
         TM    FINDSW,REFIND
         BO    P#CMD@X
         B     P#CMD@E2
P#FIND@2 EQU   *
         XC    COFFSET,COFFSET
         ST    1,ADDRESS
         GETCHN 2                                                       DPSO7027
         ST    1,0(2)
         LA    1,1(1)
         ST    1,RFADDR
         TM    FINDSW,REFIND
         BO    P#CMD@X
         B     P#CMD@N
         SPACE 3
P#ADDR   EQU   *
         CLC   CMDOLEN,=H'8'
         BH    P#ADDR@E
         MVI   P#ADDR@A,X'F0'
         MVC   P#ADDR@A+1(L'P#ADDR@A-1),P#ADDR@A
         LA    1,L'P#ADDR@A
         SH    1,CMDOLEN
         LA    1,P#ADDR@A(1)
         LH    2,CMDOLEN
         BCTR  2,0
         EX    2,P#ADDR@M
         MVC   CMDOLEN,=H'8'
         LA    2,P#ADDR@A
         LA    5,ADDRESS
         CHR2HEX 2,5,CMDOLEN
         BNZ   P#ADDR@E
         BUMP  2,ADDRESS                                                DPSO7027
         XC    COFFSET,COFFSET
         B     P#CMD@N
P#ADDR@E EQU   *
         MVC   EMSG,=CL78' '
         MVC   EMSG(15),=C'INVALID ADDRESS'
         B     P#CMD@E
P#ADDR@A DS    CL8
P#ADDR@M MVC   0(*-*,1),CMDOUT
         SPACE 3
P#OFF    EQU   *
         NI    OFFSW,X'FF'-NEGATIVE
         CLC   CMDOLEN,=H'6'                                            DPSO7027
         BH    P#OFF@E
         BL    P#OFF@1
         CLI   CMDOUT,C'-'
         BNE   P#OFF@E
P#OFF@1  EQU   *
         LA    3,CMDOUT
         CLI   CMDOUT,C'-'
         BNE   P#OFF@2
         OI    OFFSW,NEGATIVE
         LA    3,1(3)
         LH    5,CMDOLEN
         BCTR  5,0
         STH   5,CMDOLEN
P#OFF@2  EQU   *
         MVI   P#OFF@A,X'F0'
         MVC   P#OFF@A+1(L'P#OFF@A-1),P#OFF@A
         LA    1,L'P#OFF@A
         SH    1,CMDOLEN
         LA    1,P#OFF@A(1)
         LH    2,CMDOLEN
         BCTR  2,0
         EX    2,P#OFF@M
         MVC   CMDOLEN,=H'8'                                            DPSO7027
         LA    2,P#OFF@A
         LA    5,COFFSET
         CHR2HEX 2,5,CMDOLEN
         BNZ   P#OFF@E
         TM    OFFSW,NEGATIVE
         BNO   P#OFF@X
         L     5,COFFSET                                                DPSO7027
         MH    5,=H'-1'
         ST    5,COFFSET                                                DPSO7027
P#OFF@X  EQU   *
         L     1,ADDRESS
         A     1,COFFSET                                                DPSO7027
         GETCHN 2                                                       DPSO7027
         ST    1,0(2)
         B     P#CMD@N
P#OFF@E  EQU   *
         MVC   EMSG,=CL78' '
         MVC   EMSG(14),=C'INVALID OFFSET'
         B     P#CMD@E
CMDTRT   DC    X'00'
OFFSW    DS    X
NEGATIVE EQU   X'80'
P#OFF@A  DS    CL8                                                      DPSO7027
P#OFF@M  MVC   0(*-*,1),0(3)
         SPACE 3
P#BADDR  EQU   *
         L     1,ADDRESS
         A     1,COFFSET                                                DPSO7027
         MVC   ADDRESS,0(1)
         MVI   ADDRESS,X'00'
         BUMP  2,ADDRESS                                                DPSO7027
         XC    COFFSET,COFFSET
         B     P#CMD@N
         SPACE 3
P#BADDR3 EQU   *
         L     1,ADDRESS
         A     1,COFFSET                                                DPSO7027
         MVC   ADDRESS,0(1)
         BUMP  2,ADDRESS                                                DPSO7027
         XC    COFFSET,COFFSET
         B     P#CMD@N
         SPACE 3
P#PASS   EQU   *
         OI    CMDSW,PASSWORD
         NI    CMDSW,X'FF'-VERIFIED
         B     P#CMD@N
         SPACE 3
P#PROT   EQU   *
         NI    CMDSW,X'FF'-VERIFIED
         B     P#CMD@N
         ENTRY P#CMD@E
         SPACE 3
P#CMD@E  EQU   *
         AIF   (&MVS).MVS15
         BALR  7,0
         AGO   .MVS16
.MVS15   ANOP
         BASR  7,0
.MVS16   ANOP
         LA    15,*-CMDBASE
         SR    7,15
         L     4,@CMD                                                   DPSO7027
         MVC   FLDLEN,CMDLENSV
         SETATTR OFFSET,DFHUNIMD
         LA    6,ECURSOR
         CURSORX 3,2,6
         LH    6,FLDLEN
         BCTR  6,0
         EX    6,CMDMOVE
         OC    EIBTRMID,EIBTRMID                                        DPSO7027
         BNZ   P#CMD@X                                                  DPSO7027
         DC    X'0000'                                                  DPSO7027
         DC    C'FORCED ABEND - INVALID COMMAND'                        DPSO7027
         SPACE 3
         ENTRY P#CMD@E2
P#CMD@E2 EQU   *
         AIF   (&MVS).MVS17
         BALR  7,0
         AGO   .MVS18
.MVS17   ANOP
         BASR  7,0
.MVS18   ANOP
         LA    15,*-CMDBASE
         SR    7,15
         L     4,@CMD                                                   DPSO7027
         MVC   FLDLEN,CMDLENSV
         LA    6,ECURSOR
         CURSORX 3,2,6
         LH    6,FLDLEN
         BCTR  6,0
         EX    6,CMDMOVE
         OC    EIBTRMID,EIBTRMID                                        DPSO7027
         BNZ   P#CMD@X                                                  DPSO7027
         DC    X'0000'                                                  DPSO7027
         DC    C'FORCED ABEND - INVALID COMMAND'                        DPSO7027
         SPACE 3
         ENTRY P#CMD@N
P#CMD@N  EQU   *
         AIF   (&MVS).MVS19
         BALR  7,0
         AGO   .MVS20
.MVS19   ANOP
         BASR  7,0
.MVS20   ANOP
         LA    15,*-CMDBASE
         SR    7,15
         LEFTC 4,FLDLEN                                                 DPSO7027
         OC    FLDLEN,FLDLEN
         BZ    P#CMD@X                                                  DPSO7027
         CLI   CMDEND,C'Y'                                              DPSO7027
         BE    CMDSTRT                                                  DPSO7027
         B     CMDGET                                                   DPSO7027
P#CMD@X  EQU   *
         NI    FINDSW,X'FF'-REFIND
         LM    14,12,12(13)
         BR    14
         SPACE 3
CMDEND   DS    C                                                        DPSO7027
CMDCOMP  CLC   0(*-*,4),CMDID
CMDFIND  CLC   0(*-*,1),FINDSTR
CMDMOVE  MVC   ECMD(*-*),0(4)
         EJECT
CMDTAB   DS    0F
         COMMAND CMD=ADDRESS,LABEL=P#ADDR,CSECT=CMDS,                  X
               OPTION=PARMS
         COMMAND CMD=ABENDOFF,LABEL=P#ABENDF,CSECT=CMDS4                DPSO7027
         COMMAND CMD=ABENDON,LABEL=P#ABENDO,CSECT=CMDS4                 DPSO7027
         COMMAND CMD=ADDR,LABEL=P#ADDR,CSECT=CMDS,                     X
               OPTION=PARMS
         COMMAND CMD=AEFI,LABEL=P#AEFI,CSECT=CMDS2                      DPSO7027
         COMMAND CMD=AEFX,LABEL=P#AEFX,CSECT=CMDS2                      DPSO7027
         COMMAND CMD=AFCB,LABEL=P#AFCB,CSECT=CMDS4                      DPSO7027
         COMMAND CMD=AICB,LABEL=P#AICB,CSECT=CMDS4                      DPSO7027
         COMMAND CMD=A,LABEL=P#ADDR,CSECT=CMDS,                        X
               OPTION=PARMS
         COMMAND CMD=BASE3,LABEL=P#BADDR3,CSECT=CMDS
         COMMAND CMD=BASE,LABEL=P#BADDR,CSECT=CMDS
         COMMAND CMD=B3,LABEL=P#BADDR3,CSECT=CMDS
         COMMAND CMD=B,LABEL=P#BADDR,CSECT=CMDS
*        COMMAND CMD=CEMTOFF,LABEL=P#XEMTFF,CSECT=CMDS4,               XDPSO7027
               OPTION=VERIFIED                                          DPSO7027
*        COMMAND CMD=CEMTON,LABEL=P#XEMTON,CSECT=CMDS4,                XDPSO7027
               OPTION=VERIFIED                                          DPSO7027
         COMMAND CMD=CEMT,LABEL=P#CEMT,CSECT=CMDS4,                    XDPSO7027
               OPTION=VERIFIED                                          DPSO7027
         COMMAND CMD=CLOSE,LABEL=P#CLOSE,CSECT=CMDS4,                  XDPSO7027
               OPTION=PARMS+VERIFIED                                    DPSO7027
         COMMAND CMD=CSA,LABEL=P#CSA,CSECT=CMDS2                        DPSO7027
         COMMAND CMD=CWA,LABEL=P#CWA,CSECT=CMDS2                        DPSO7027
         COMMAND CMD=DCT,LABEL=P#DCT,CSECT=CMDS2,                      X
               OPTION=PARMS
         COMMAND CMD=FIND,LABEL=P#FIND,CSECT=CMDS,                     X
               OPTION=PARMS
         COMMAND CMD=FCT,LABEL=P#FCT,CSECT=CMDS2,                      X
               OPTION=PARMS
         COMMAND CMD=F,LABEL=P#FIND,CSECT=CMDS,                        X
               OPTION=PARMS
         COMMAND CMD=INQPROG,LABEL=P#IPRG,CSECT=CMDS3,                 X
               OPTION=PARMS
         COMMAND CMD=IP,LABEL=P#IPRG,CSECT=CMDS3,                      X
               OPTION=PARMS
         COMMAND CMD=LOADHOLD,LABEL=P#LOADH,CSECT=CMDS3,               X
               OPTION=PARMS+VERIFIED
         COMMAND CMD=LOADMOD,LABEL=P#PPTL,CSECT=CMDS2,                 XDPSO7027
               OPTION=PARMS                                             DPSO7027
         COMMAND CMD=LM,LABEL=P#PPTL,CSECT=CMDS2,                      X
               OPTION=PARMS
         COMMAND CMD=LH,LABEL=P#LOADH,CSECT=CMDS3,                     X
               OPTION=PARMS+VERIFIED
         COMMAND CMD=LOAD,LABEL=P#LOAD,CSECT=CMDS3,                    X
               OPTION=PARMS+VERIFIED
         COMMAND CMD=Q,LABEL=P#LOADM,CSECT=CMDS3,                      XDPSO6170
               OPTION=PARMS+VERIFIED                                    DPSO6170
         COMMAND CMD=L,LABEL=P#LOAD,CSECT=CMDS3,                       X
               OPTION=PARMS+VERIFIED
         COMMAND CMD=NEWCOPY,LABEL=P#NEW,CSECT=CMDS3,                  X
               OPTION=PARMS+VERIFIED
         COMMAND CMD=NEW,LABEL=P#NEW,CSECT=CMDS3,                      X
               OPTION=PARMS+VERIFIED
         COMMAND CMD=N,LABEL=P#NEW,CSECT=CMDS3,                        X
               OPTION=PARMS+VERIFIED
         COMMAND CMD=OPEN,LABEL=P#OPEN,CSECT=CMDS4,                    XDPSO7027
               OPTION=PARMS+VERIFIED                                    DPSO7027
         COMMAND CMD=OFFSET,LABEL=P#OFF,CSECT=CMDS,                    X
               OPTION=PARMS
         COMMAND CMD=OFF,LABEL=P#OFF,CSECT=CMDS,                       X
               OPTION=PARMS
         COMMAND CMD=O,LABEL=P#OFF,CSECT=CMDS,                         X
               OPTION=PARMS
         COMMAND CMD=PASSWORD,LABEL=P#PASS,CSECT=CMDS
         COMMAND CMD=PROTECT,LABEL=P#PROT,CSECT=CMDS
         COMMAND CMD=PASS,LABEL=P#PASS,CSECT=CMDS
         COMMAND CMD=PCTR,LABEL=P#PCTR,CSECT=CMDS2,                    X
               OPTION=PARMS
         COMMAND CMD=PCT,LABEL=P#PCT,CSECT=CMDS2,                      X
               OPTION=PARMS
         COMMAND CMD=PFT,LABEL=P#PFT,CSECT=CMDS2,                      X
               OPTION=PARMS
         COMMAND CMD=PPT,LABEL=P#PPT,CSECT=CMDS2,                      X
               OPTION=PARMS
         COMMAND CMD=RELEASE,LABEL=P#REL,CSECT=CMDS3,                  X
               OPTION=PARMS+VERIFIED
         COMMAND CMD=REL,LABEL=P#REL,CSECT=CMDS3,                      X
               OPTION=PARMS+VERIFIED
         COMMAND CMD=REFRESH,LABEL=P#REF,CSECT=CMDS3,                  X
               OPTION=PARMS+VERIFIED
         COMMAND CMD=REF,LABEL=P#REF,CSECT=CMDS3,                      X
               OPTION=PARMS+VERIFIED
         COMMAND CMD=R,LABEL=P#REL,CSECT=CMDS3,                        X
               OPTION=PARMS+VERIFIED
         COMMAND CMD=S,LABEL=P#SEND,CSECT=CMDS4,                       XDPSO7027
               OPTION=PARMS                                             DPSO7027
         COMMAND CMD=SE,LABEL=P#SENDE,CSECT=CMDS4,                     XDPSO7027
               OPTION=PARMS                                             DPSO7027
         COMMAND CMD=SEND,LABEL=P#SEND,CSECT=CMDS4,                    XDPSO7027
               OPTION=PARMS                                             DPSO7027
         COMMAND CMD=SENDE,LABEL=P#SENDE,CSECT=CMDS4,                  XDPSO7027
               OPTION=PARMS                                             DPSO7027
         COMMAND CMD=SETBASE,LABEL=P#SB,CSECT=CMDS2                     DPSO7027
         COMMAND CMD=SB,LABEL=P#SB,CSECT=CMDS2                          DPSO7027
         COMMAND CMD=TCTUA,LABEL=P#TCTUA,CSECT=CMDS2,                  X
               OPTION=PARMS
         COMMAND CMD=TCTN,LABEL=P#TCTN,CSECT=CMDS2,                    X
               OPTION=PARMS
         COMMAND CMD=TCTS,LABEL=P#TCTS,CSECT=CMDS2,                    X
               OPTION=PARMS
         COMMAND CMD=TCT,LABEL=P#TCT,CSECT=CMDS2,                      X
               OPTION=PARMS
         COMMAND CMD=VER,LABEL=P#VER,CSECT=CMDS3
         COMMAND CMD=VERSION,LABEL=P#VER,CSECT=CMDS3
CMDTABN  EQU   (*-CMDTAB)/CMDTABL
         LTORG
TEMP1    DC    X'FBD2D1F9E5E8F2'
TEMP2    DC    X'8184445845A2A2'
         EJECT
         MEND
         MACRO
         FRED5
         GBLB  &B2SF,&H2CF,&H2DF,&ORF,&ORHF,&GINF,&C2HF,&MVS
         GBLC  &CS,&VERS
CMDS2    CSECT
         USING *,7
         ENTRY P#SB                                                     DPSO7027
P#SB     EQU   *                                                        DPSO7027
         AIF   (&MVS).SB1                                               DPSO7027
         BALR  7,0                                                      DPSO7027
         AGO   .SB2                                                     DPSO7027
.SB1     ANOP                                                           DPSO7027
         BASR  7,0                                                      DPSO7027
.SB2     ANOP                                                           DPSO7027
         LA    15,*-CMDS2                                               DPSO7027
         SR    7,15                                                     DPSO7027
         L     1,ADDRESS                                                DPSO7027
         A     1,COFFSET                                                DPSO7027
         ST    1,ADDRESS                                                DPSO7027
         XC    COFFSET,COFFSET                                          DPSO7027
         L     15,=V(P#CMD@N)                                           DPSO7027
         BR    15                                                       DPSO7027
         SPACE 3                                                        DPSO7027
         ENTRY P#AEFI                                                   DPSO7027
P#AEFI   EQU   *                                                        DPSO7027
         AIF   (&MVS).MVSX1AI                                           DPSO7027
         BALR  7,0                                                      DPSO7027
         AGO   .MVSX2AI                                                 DPSO7027
.MVSX1AI ANOP                                                           DPSO7027
         BASR  7,0                                                      DPSO7027
.MVSX2AI ANOP                                                           DPSO7027
         LA    15,*-CMDS2                                               DPSO7027
         SR    7,15                                                     DPSO7027
         EXEC CICS ADDRESS CWA(1)                                       DPSO7027
         L     1,X'20'(1)              TMT@
         L     1,X'18'(1)              LMT@
         L     1,X'1C0'(1)             INCLUSION LIST
         ST    1,ADDRESS                                                DPSO7027
         BUMP  2,ADDRESS                                                DPSO7027
         XC    COFFSET,COFFSET                                          DPSO7027
         L     15,=V(P#CMD@N)                                           DPSO7027
         BR    15                                                       DPSO7027
                                                                SPACE 3 DPSO7027
         ENTRY P#AEFX                                                   DPSO7027
P#AEFX   EQU   *                                                        DPSO7027
         AIF   (&MVS).MVSX1AX                                           DPSO7027
         BALR  7,0                                                      DPSO7027
         AGO   .MVSX2AX                                                 DPSO7027
.MVSX1AX ANOP                                                           DPSO7027
         BASR  7,0                                                      DPSO7027
.MVSX2AX ANOP                                                           DPSO7027
         LA    15,*-CMDS2                                               DPSO7027
         SR    7,15                                                     DPSO7027
         EXEC CICS ADDRESS CWA(1)                                       DPSO7027
         L     1,X'20'(1)              TMT@
         L     1,X'18'(1)              LMT@
         L     1,X'F8'(1)              EXCLUSION LIST
         ST    1,ADDRESS                                                DPSO7027
         BUMP  2,ADDRESS                                                DPSO7027
         XC    COFFSET,COFFSET                                          DPSO7027
         L     15,=V(P#CMD@N)                                           DPSO7027
         BR    15                                                       DPSO7027
                                                                SPACE 3 DPSO7027
         ENTRY P#CSA                                                    DPSO7027
P#CSA    EQU   *                                                        DPSO7027
         AIF   (&MVS).MVSX1                                             DPSO7027
         BALR  7,0                                                      DPSO7027
         AGO   .MVSX2                                                   DPSO7027
.MVSX1   ANOP                                                           DPSO7027
         BASR  7,0                                                      DPSO7027
.MVSX2   ANOP                                                           DPSO7027
         LA    15,*-CMDS2                                               DPSO7027
         SR    7,15                                                     DPSO7027
         MVC   ADDRESS,@CSA                                             DPSO7027
         BUMP  2,ADDRESS                                                DPSO7027
         XC    COFFSET,COFFSET                                          DPSO7027
         L     15,=V(P#CMD@N)                                           DPSO7027
         BR    15                                                       DPSO7027
         SPACE 3                                                        DPSO7027
         ENTRY P#CWA                                                    DPSO7027
P#CWA    EQU   *                                                        DPSO7027
         AIF   (&MVS).MVSX3                                             DPSO7027
         BALR  7,0                                                      DPSO7027
         AGO   .MVSX4                                                   DPSO7027
.MVSX3   ANOP                                                           DPSO7027
         BASR  7,0                                                      DPSO7027
.MVSX4   ANOP                                                           DPSO7027
         LA    15,*-CMDS2                                               DPSO7027
         SR    7,15                                                     DPSO7027
         EXEC CICS ADDRESS CWA(1)                                       DPSO7027
         ST    1,ADDRESS                                                DPSO7027
         BUMP  2,ADDRESS                                                DPSO7027
         XC    COFFSET,COFFSET                                          DPSO7027
         L     15,=V(P#CMD@N)                                           DPSO7027
         BR    15                                                       DPSO7027
         SPACE 3                                                        DPSO7027
         ENTRY P#PCT                                                    DPSO7027
P#PCT    EQU   *
         AIF   (&MVS).MVS21
         BALR  7,0
         AGO   .MVS22
.MVS21   ANOP
         BASR  7,0
.MVS22   ANOP
         LA    15,*-CMDS2
         SR    7,15
         MVC   REQNAME,=CL8'PCT'       REQUEST SERVICE
         MVC   REQACTN,=CL4' '         REQUEST ACTION
         BAL   14,CALL824P             CALL PROGRAM KPS824
         OC    @TABLE,@TABLE           TABLE ADDRESS RETURNED?
         BZ    P#PCT@E                 NO, PROCESS AS ERROR
         XC    COFFSET,COFFSET
         MVC   ADDRESS,@TABLE
         BUMP  2,ADDRESS                                                DPSO7027
         L     15,=V(P#CMD@N)
         BR    15
P#PCT@E  EQU   *
         MVC   EMSG,=CL78' '
         MVC   EMSG(27),=C'TRANSACTION ENTRY NOT FOUND'
         L     15,=V(P#CMD@E)
         BR    15
         SPACE 4
         ENTRY P#PPT
P#PPT    EQU   *
         AIF   (&MVS).MVS23
         BALR  7,0
         AGO   .MVS24
.MVS23   ANOP
         BASR  7,0
.MVS24   ANOP
         LA    15,*-CMDS2
         SR    7,15
         MVC   REQNAME,=CL8'PPT'       REQUEST SERVICE
         MVC   REQACTN,=CL4' '         REQUEST ACTION
         BAL   14,CALL824P             CALL PROGRAM KPS824
         OC    @TABLE,@TABLE           TABLE ADDRESS RETURNED?
         BZ    P#PPT@E                 NO, PROCESS AS ERROR
         XC    COFFSET,COFFSET
         MVC   ADDRESS,@TABLE
         BUMP  2,ADDRESS                                                DPSO7027
         L     15,=V(P#CMD@N)
         BR    15
P#PPT@E  EQU   *
         MVC   EMSG,=CL78' '
         MVC   EMSG(23),=C'PROGRAM ENTRY NOT FOUND'
         L     15,=V(P#CMD@E)
         BR    15
         SPACE 4
P#PPTL   EQU   *
         AIF   (&MVS).MVS25
         BALR  7,0
         AGO   .MVS26
.MVS25   ANOP
         BASR  7,0
.MVS26   ANOP
         LA    15,*-CMDS2
         SR    7,15
         MVC   REQNAME,=CL8'PPT'       REQUEST SERVICE
         MVC   REQACTN,=CL4' '         REQUEST ACTION
         BAL   14,CALL824P             CALL PROGRAM KPS824
         OC    @TABLE,@TABLE           TABLE ADDRESS RETURNED?
         BZ    P#PPTL@E                NO, PROCESS AS ERROR
         L     2,@TABLE
         USING DFHPPTDS,PPTCBAR
         ICM   1,B'1111',PPTCSA
         BZ    P#PPTL@1
         ST    1,ADDRESS
         OC    PPTRCC,PPTRCC
         BNZ   *+10
         MVC   EMSG,=CL78' '
         MVC   EMSG(37),=C'WARNING - LOAD MODULE IS NOT RESIDENT'
         XC    COFFSET,COFFSET
         BUMP  2,ADDRESS                                                DPSO7027
         L     15,=V(P#CMD@N)
         BR    15
P#PPTL@1 EQU   *
         MVC   EMSG,=CL78' '
         MVC   EMSG(28),=C'PROGRAM NOT LOADED IN MEMORY'
         L     15,=V(P#CMD@E)
         BR    15
P#PPTL@E EQU   *
         MVC   EMSG,=CL78' '
         MVC   EMSG(23),=C'PROGRAM ENTRY NOT FOUND'
         L     15,=V(P#CMD@E)
         BR    15
         SPACE 4
P#PFT    EQU   *
         AIF   (&MVS).MVS27
         BALR  7,0
         AGO   .MVS28
.MVS27   ANOP
         BASR  7,0
.MVS28   ANOP
         LA    15,*-CMDS2
         SR    7,15
         MVC   REQNAME,=CL8'PFT'       REQUEST SERVICE
         MVC   REQACTN,=CL4' '         REQUEST ACTION
         BAL   14,CALL824P             CALL PROGRAM KPS824
         OC    @TABLE,@TABLE           TABLE ADDRESS RETURNED?
         BZ    P#PFT@E                 NO, PROCESS AS ERROR
         XC    COFFSET,COFFSET
         MVC   ADDRESS,@TABLE
         BUMP  2,ADDRESS                                                DPSO7027
         L     15,=V(P#CMD@N)
         BR    15
P#PFT@E  EQU   *
         MVC   EMSG,=CL78' '
         MVC   EMSG(19),=C'PFT ENTRY NOT FOUND'
         L     15,=V(P#CMD@E)
         BR    15
         SPACE 4
P#DCT    EQU   *
         AIF   (&MVS).MVS29
         BALR  7,0
         AGO   .MVS30
.MVS29   ANOP
         BASR  7,0
.MVS30   ANOP
         LA    15,*-CMDS2
         SR    7,15
         MVC   REQNAME,=CL8'DCT'       REQUEST SERVICE
         MVC   REQACTN,=CL4' '         REQUEST ACTION
         BAL   14,CALL824P             CALL PROGRAM KPS824
         OC    @TABLE,@TABLE           TABLE ADDRESS RETURNED?
         BZ    P#DCT@E                 NO, PROCESS AS ERROR
         XC    COFFSET,COFFSET
         MVC   ADDRESS,@TABLE
         BUMP  2,ADDRESS                                                DPSO7027
         L     15,=V(P#CMD@N)
         BR    15
P#DCT@E  EQU   *
         MVC   EMSG,=CL78' '
         MVC   EMSG(36),=C'TRANSIENT DATA QUEUE ENTRY NOT FOUND'
         L     15,=V(P#CMD@E)
         BR    15
         SPACE 4
P#FCT    EQU   *
         AIF   (&MVS).MVS31
         BALR  7,0
         AGO   .MVS32
.MVS31   ANOP
         BASR  7,0
.MVS32   ANOP
         LA    15,*-CMDS2
         SR    7,15
         MVC   REQNAME,=CL8'FCT'       REQUEST SERVICE
         MVC   REQACTN,=CL4' '         REQUEST ACTION
         BAL   14,CALL824P             CALL PROGRAM KPS824
         OC    @TABLE,@TABLE           TABLE ADDRESS RETURNED?
         BZ    P#FCT@E                 NO, PROCESS AS ERROR
         XC    COFFSET,COFFSET
         MVC   ADDRESS,@TABLE
         BUMP  2,ADDRESS                                                DPSO7027
         L     15,=V(P#CMD@N)
         BR    15
P#FCT@E  EQU   *
         MVC   EMSG,=CL78' '
         MVC   EMSG(20),=C'FILE ENTRY NOT FOUND'
         L     15,=V(P#CMD@E)
         BR    15
         SPACE 4
P#TCT    EQU   *
         AIF   (&MVS).MVS33
         BALR  7,0
         AGO   .MVS34
.MVS33   ANOP
         BASR  7,0
.MVS34   ANOP
         LA    15,*-CMDS2
         SR    7,15
         MVC   REQNAME,=CL8'TCT'       REQUEST SERVICE
         MVC   REQACTN,=CL4' '         REQUEST ACTION
         BAL   14,CALL824P             CALL PROGRAM KPS824
         OC    @TABLE,@TABLE           TABLE ADDRESS RETURNED?
         BZ    P#TCT@E                 NO, PROCESS AS ERROR
         XC    COFFSET,COFFSET
         MVC   ADDRESS,@TABLE
         BUMP  2,ADDRESS                                                DPSO7027
         L     15,=V(P#CMD@N)
         BR    15
P#TCT@E  EQU   *
         MVC   EMSG,=CL78' '
         MVC   EMSG(24),=C'TERMINAL ENTRY NOT FOUND'
         L     15,=V(P#CMD@E)
         BR    15
         SPACE 4
P#TCTUA  EQU   *
         AIF   (&MVS).MVS33X
         BALR  7,0
         AGO   .MVS34X
.MVS33X  ANOP
         BASR  7,0
.MVS34X  ANOP
         LA    15,*-CMDS2
         SR    7,15
         MVC   REQNAME,=CL8'TCTUA'     REQUEST SERVICE
         MVC   REQACTN,=CL4'TERM'      REQUEST ACTION
         BAL   14,CALL824P             CALL PROGRAM KPS824
         OC    @TABLE2,@TABLE2         2NDARY ADDRESS RETURNED?
         BZ    P#TCTU@E                NO, PROCESS AS ERROR
         XC    COFFSET,COFFSET
*<=====  MVC   ADDRESS,@TABLE
         MVC   ADDRESS,@TABLE2
         BUMP  2,ADDRESS                                                DPSO7027
         L     15,=V(P#CMD@N)
         BR    15
P#TCTU@E  EQU   *
         MVC   EMSG,=CL78' '
         MVC   EMSG(29),=C'TERMINAL USER ENTRY NOT FOUND'
         L     15,=V(P#CMD@E)
         BR    15
         SPACE 4
P#TCTN   EQU   *
         AIF   (&MVS).MVS35
         BALR  7,0
         AGO   .MVS36
.MVS35   ANOP
         BASR  7,0
.MVS36   ANOP
         LA    15,*-CMDS2
         SR    7,15
         MVC   REQNAME,=CL8'TCTN'      REQUEST SERVICE
         MVC   REQACTN,=CL4' '         REQUEST ACTION
         BAL   14,CALL824P             CALL PROGRAM KPS824
         OC    @TABLE,@TABLE           TABLE ADDRESS RETURNED?
         BZ    P#TCTN@E                NO, PROCESS AS ERROR
         XC    COFFSET,COFFSET
         MVC   ADDRESS,@TABLE
         BUMP  2,ADDRESS                                                DPSO7027
         L     15,=V(P#CMD@N)
         BR    15
P#TCTN@E EQU   *
         MVC   EMSG,=CL78' '
         MVC   EMSG(24),=C'TERMINAL ENTRY NOT FOUND'
         L     15,=V(P#CMD@E)
         BR    15
         SPACE 4
P#TCTS   EQU   *
         AIF   (&MVS).MVS37
         BALR  7,0
         AGO   .MVS38
.MVS37   ANOP
         BASR  7,0
.MVS38   ANOP
         LA    15,*-CMDS2
         SR    7,15
         MVC   REQNAME,=CL8'TCTS'      REQUEST SERVICE
         MVC   REQACTN,=CL4' '         REQUEST ACTION
         BAL   14,CALL824P             CALL PROGRAM KPS824
         OC    @TABLE,@TABLE           TABLE ADDRESS RETURNED?
         BZ    P#TCTS@E                NO, PROCESS AS ERROR
         XC    COFFSET,COFFSET
         MVC   ADDRESS,@TABLE
         BUMP  2,ADDRESS                                                DPSO7027
         L     15,=V(P#CMD@N)
         BR    15
P#TCTS@E EQU   *
         MVC   EMSG,=CL78' '
         MVC   EMSG(24),=C'TERMINAL ENTRY NOT FOUND'
         L     15,=V(P#CMD@E)
         BR    15
         SPACE 4
P#PCTR   EQU   *
         AIF   (&MVS).MVS39
         BALR  7,0
         AGO   .MVS40
.MVS39   ANOP
         BASR  7,0
.MVS40   ANOP
         LA    15,*-CMDS2
         SR    7,15
         MVC   REQNAME,=CL8'RPCT'      REQUEST SERVICE
         MVC   REQACTN,=CL4' '         REQUEST ACTION
         BAL   14,CALL824P             CALL PROGRAM KPS824
         OC    @TABLE,@TABLE           TABLE ADDRESS RETURNED?
         BZ    P#PCTR@E                NO, PROCESS AS ERROR
         XC    COFFSET,COFFSET
         MVC   ADDRESS,@TABLE
         BUMP  2,ADDRESS                                                DPSO7027
         L     15,=V(P#CMD@N)
         BR    15
P#PCTR@E EQU   *
         MVC   EMSG,=CL78' '
         MVC   EMSG(20),=C'PCTR ENTRY NOT FOUND'
         L     15,=V(P#CMD@E)
         BR    15
         SPACE 4
CALL824P DS    0H
         ST    14,SAVE14               SAVE RETURN ADDRESS
         LA    6,PARMBLK               KPS0824 PARAMETER BLOCK
         USING P824DS,6                ADDRESSABILITY
         LA    0,@CSA                  PTR TO CSA ADDRESS
         ST    0,PARM                  PTR TO CSA ADDRESS
         ST    6,PARM+4                PTR TO KPS0824 PARM
         LA    1,PARM                  PARM BLOCK FOR CALL
         MVC   P824NME,CMDOUT          MOVE COMMAND NAME
         MVC   P824REQ,REQNAME         REQUEST SERVICE
         MVC   P824ACT,REQACTN         REQUEST ACTION
         ST    13,SAVESUB1+4           SAVE R13
         LA    13,SAVESUB1             POINT R13 TO MY SAVE AREA
         CALL  KPS0824                 PROCESS REQUEST
         L     13,SAVESUB1+4           RESTORE R13
         MVC   @TABLE,P824VALA         RESULTANT ADDRESS
         MVC   @TABLE2,P824RSPA        RESULTANT RESPONSE
         DROP  6                       RELINQUISH ADDRESSABILITY
         L     6,@TABLE                RESTORE WORK REGISTER
         L     14,SAVE14               RESTORE RETURN ADDRESS
         BR    14                      RETURN TO CALLER
         SPACE 4
         LTORG
         EJECT
         MEND
         MACRO
         FRED6
         GBLB  &B2SF,&H2CF,&H2DF,&ORF,&ORHF,&GINF,&C2HF,&MVS
         GBLC  &CS,&VERS
CMDS3    CSECT
         USING *,7
P#VER    EQU   *
         AIF   (&MVS).MVS41
         BALR  7,0
         AGO   .MVS42
.MVS41   ANOP
         BASR  7,0
.MVS42   ANOP
         LA    15,*-CMDS3
         SR    7,15
         EXEC CICS INQUIRE SYSTEM RELEASE(SYSREL) NOHANDLE
         CLC   EIBRESP,DFHRESP(NORMAL)
         BE    P#VER@1
         MVC   EMSG,=CL78' '
         MVC   EMSG(36),=C'INQUIRY OF SYSTEM INFORMATION FAILED'
         L     15,=V(P#CMD@E)
         BR    15
P#VER@1  EQU   *
         MVI   EMSG,C' '
         MVC   EMSG+1(L'EMSG-1),EMSG
         MVC   EMSG(13),=C'CICS VERSION('
         MVC   EMSG+13(4),SYSREL
         MVI   EMSG+17,C')'
         L     15,=V(P#CMD@N)
         BR    15
SYSREL   DS    CL4
         SPACE 4
P#IPRG   EQU   *
         AIF   (&MVS).MVS43
         BALR  7,0
         AGO   .MVS44
.MVS43   ANOP
         BASR  7,0
.MVS44   ANOP
         LA    15,*-CMDS3
         SR    7,15
         EXEC CICS INQUIRE PROGRAM(CMDOUT) RESCOUNT(RESCOUNT)          X
               USECOUNT(USECOUNT) NOHANDLE
         CLC   EIBRESP,DFHRESP(NORMAL)
         BE    P#IPRG@1
         MVC   EMSG,=CL78' '
         MVC   EMSG(37),=C'INQUIRY OF PROGRAM INFORMATION FAILED'
         L     15,=V(P#CMD@E)
         BR    15
P#IPRG@1 EQU   *
         MVI   EMSG,C' '
         MVC   EMSG+1(L'EMSG-1),EMSG
         MVC   EMSG(8),CMDOUT
         MVC   EMSG+8(12),=C' - RESCOUNT('
         FW2DEC4 RESCOUNT,EMSG+20
         MVC   EMSG+24(12),=C')  USECOUNT('
         FW2DEC4 USECOUNT,EMSG+36
         MVI   EMSG+40,C')'
         L     15,=V(P#CMD@N)
         BR    15
USECOUNT DS    F
RESCOUNT DS    F
LOADADDR DS    F                                                        DPSO6170
         SPACE 4
P#LOAD   EQU   *
         AIF   (&MVS).MVS45
         BALR  7,0
         AGO   .MVS46
.MVS45   ANOP
         BASR  7,0
.MVS46   ANOP
         LA    15,*-CMDS3
         SR    7,15
         EXEC CICS LOAD PROGRAM(CMDOUT) ENTRY(1) NOHANDLE
         CLC   EIBRESP,DFHRESP(NORMAL)
         BE    P#LOAD@1
         MVC   EMSG,=CL78' '
         MVC   EMSG(11),=C'LOAD FAILED'
         L     15,=V(P#CMD@E)
         BR    15
P#LOAD@1 EQU   *
         ST    1,ADDRESS
         BUMP  2,ADDRESS                                                DPSO7027
         XC    COFFSET,COFFSET
         L     15,=V(P#CMD@N)
         BR    15
         SPACE 4
P#LOADM  EQU   *                                                        DPSO6170
         BASR  7,0                                                      DPSO6170
         LA    15,*-CMDS3                                               DPSO6170
         SR    7,15                                                     DPSO6170
         CSVQUERY INEPNAME=CMDOUT,OUTLOADPT=LOADADDR                    DPSO6170
         OC    LOADADDR,LOADADDR                                        DPSO6170
         BNZ   P#LOADM1                                                 DPSO6170
         LOAD  EPLOC=CMDOUT,ERRET=P#LOADME                              DPSO6170
         ST    0,LOADADDR                                               DPSO6170
P#LOADM1 EQU   *                                                        DPSO6170
         MVC   ADDRESS,LOADADDR                                         DPSO6170
         BUMP  2,ADDRESS                                                DPSO6170
         XC    COFFSET,COFFSET                                          DPSO6170
         L     15,=V(P#CMD@N)                                           DPSO6170
         BR    15                                                       DPSO6170
P#LOADME EQU   *                                                        DPSO6170
         MVC   EMSG,=CL78' '
         MVC   EMSG(12),=C'QUERY FAILED'                                DPSO6170
         L     15,=V(P#CMD@E)                                           DPSO6170
         BR    15                                                       DPSO6170
         SPACE 4                                                        DPSO6170
P#LOADH  EQU   *
         AIF   (&MVS).MVS47
         BALR  7,0
         AGO   .MVS48
.MVS47   ANOP
         BASR  7,0
.MVS48   ANOP
         LA    15,*-CMDS3
         SR    7,15
         EXEC CICS LOAD PROGRAM(CMDOUT) ENTRY(1) HOLD NOHANDLE
         CLC   EIBRESP,DFHRESP(NORMAL)
         BE    P#LOADH1
         MVC   EMSG,=CL78' '
         MVC   EMSG(16),=C'LOAD HOLD FAILED'
         L     15,=V(P#CMD@E)
         BR    15
P#LOADH1 EQU   *
         ST    1,ADDRESS
         BUMP  2,ADDRESS                                                DPSO7027
         XC    COFFSET,COFFSET
         L     15,=V(P#CMD@N)
         BR    15
         SPACE 4
P#REL    EQU   *
         AIF   (&MVS).MVS49
         BALR  7,0
         AGO   .MVS50
.MVS49   ANOP
         BASR  7,0
.MVS50   ANOP
         LA    15,*-CMDS3
         SR    7,15
         EXEC CICS INQUIRE PROGRAM(CMDOUT) RESCOUNT(RESCOUNT) NOHANDLE
         CLC   EIBRESP,DFHRESP(NORMAL)
         BE    P#REL@1
         MVC   EMSG,=CL78' '
         MVC   EMSG(14),=C'RELEASE FAILED'
         L     15,=V(P#CMD@E)
         BR    15
P#REL@1  EQU   *
         OC    RESCOUNT,RESCOUNT
         BNZ   P#REL@2
         MVC   EMSG,=CL78' '
         MVC   EMSG(35),=C'PROGRAM NOT RELEASED - NOT RESIDENT'
         L     15,=V(P#CMD@E)
         BR    15
P#REL@2  EQU   *
         EXEC CICS RELEASE PROGRAM(CMDOUT) NOHANDLE
         CLC   EIBRESP,DFHRESP(NORMAL)
         BE    P#REL@3
         MVC   EMSG,=CL78' '
         MVC   EMSG(14),=C'RELEASE FAILED'
         L     15,=V(P#CMD@E)
         BR    15
P#REL@3  EQU   *
         L     15,=V(P#PPT)
         BR    15
         SPACE 4
P#REF    EQU   *
         AIF   (&MVS).MVS51
         BALR  7,0
         AGO   .MVS52
.MVS51   ANOP
         BASR  7,0
.MVS52   ANOP
         LA    15,*-CMDS3
         SR    7,15
*        L     SYTCABAR,TCASYAA                                         DPSO6170
*        USING DFHTCADY,SYTCABAR                                        DPSO6170
*        L     PPTCBAR,TCAPCTA                                          DPSO6170
*        USING DFHPPTDS,PPTCBAR                                         DPSO6170
*        CLC   PPTPI,CMDOUT                                             DPSO6170
         EXEC CICS ENTER TRACENUM(1) FROM (CMDOUT)                      DPSO6170
         CLC   CMDOUT(8),=C'KPS1127 '                                   DPSO6170
         BNE   P#REF@1
         MVC   EMSG,=CL78' '
         MVC   EMSG(25),=C'CAN''T REFRESH ZAP PROGRAM'
         L     15,=V(P#CMD@E)
         BR    15
P#REF@1  EQU   *
         EXEC CICS INQUIRE PROGRAM(CMDOUT) RESCOUNT(RESCOUNT) NOHANDLE
         CLC   EIBRESP,DFHRESP(NORMAL)
         BE    P#REF@2
         MVC   EMSG,=CL78' '
         MVC   EMSG(14),=C'REFRESH FAILED'
         L     15,=V(P#CMD@E)
         BR    15
P#REF@2  EQU   *
         OC    RESCOUNT,RESCOUNT
         BZ    P#REF@3
         EXEC CICS RELEASE PROGRAM(CMDOUT) NOHANDLE
         CLC   EIBRESP,DFHRESP(NORMAL)
         BE    P#REF@3
         MVC   EMSG,=CL78' '
         MVC   EMSG(14),=C'REFRESH FAILED'
         L     15,=V(P#CMD@E)
         BR    15
P#REF@3  EQU   *
         XC    PLENGTH1,PLENGTH1
         XC    PLENGTH2,PLENGTH2
         EXEC CICS INQUIRE PROGRAM(CMDOUT) LENGTH(PLENGTH1) NOHANDLE
         CLC   EIBRESP,DFHRESP(NORMAL)
         BE    P#REF@4
         MVC   EMSG,=CL78' '
         MVC   EMSG(41),=C'INQ OF PROGRAM INFO FAILED BEFORE NEWCOPY'
         L     15,=V(P#CMD@E)
         BR    15
P#REF@4  EQU   *
         EXEC CICS SET PROGRAM(CMDOUT) NEWCOPY NOHANDLE
         CLC   EIBRESP,DFHRESP(NORMAL)
         BE    P#REF@5
         MVC   EMSG,=CL78' '
         MVC   EMSG(14),=C'NEWCOPY FAILED'
         L     15,=V(P#CMD@E)
         BR    15
P#REF@5  EQU   *
         EXEC CICS INQUIRE PROGRAM(CMDOUT) LENGTH(PLENGTH2) NOHANDLE
         CLC   EIBRESP,DFHRESP(NORMAL)
         BE    P#REF@6
         MVC   EMSG,=CL78' '
         MVC   EMSG(40),=C'INQ OF PROGRAM INFO FAILED AFTER NEWCOPY'
         L     15,=V(P#CMD@E)
         BR    15
P#REF@6  EQU   *
         MVI   EMSG,C' '
         MVC   EMSG+1(L'EMSG-1),EMSG
         MVC   EMSG(8),CMDOUT
         MVC   EMSG+8(14),=C' NEW COPIED - '
         MVC   EMSG+22(11),=C'OLD LENGTH('
         FW2DEC8 PLENGTH1,EMSG+33
         MVC   EMSG+41(14),=C')  NEW LENGTH('
         FW2DEC8 PLENGTH2,EMSG+55
         MVC   EMSG+63(13),=C') - REFRESHED'
         EXEC CICS LOAD PROGRAM(CMDOUT) ENTRY(1) HOLD NOHANDLE
         CLC   EIBRESP,DFHRESP(NORMAL)
         BE    P#REF@7
         MVC   EMSG,=CL78' '
         MVC   EMSG(16),=C'LOAD HOLD FAILED'
         L     15,=V(P#CMD@E)
         BR    15
P#REF@7  EQU   *
         ST    1,ADDRESS
         BUMP  2,ADDRESS                                                DPSO7027
         XC    COFFSET,COFFSET
         L     15,=V(P#CMD@N)
         BR    15
P#NEW    EQU   *
         AIF   (&MVS).MVS53
         BALR  7,0
         AGO   .MVS54
.MVS53   ANOP
         BASR  7,0
.MVS54   ANOP
         LA    15,*-CMDS3
         SR    7,15
         XC    PLENGTH1,PLENGTH1
         XC    PLENGTH2,PLENGTH2
         CICS@ TCA,BASE=TCACBAR,USING=NO TCA(U) @
         L     SYTCABAR,TCASYAA
         USING DFHTCADY,SYTCABAR
         L     PPTCBAR,TCAPCTA
         USING DFHPPTDS,PPTCBAR
         CLC   PPTPI,CMDOUT
*        BNE   P#NEW@1                                                  DPSO7027
*        OI    PPTTLR2,PPTNCPYR                                         DPSO7027
*        MVC   PLENGTH1,PPTSAR                                          DPSO7027
*        B     P#NEW@4                                                  DPSO7027
P#NEW@1  EQU   *
         EXEC CICS INQUIRE PROGRAM(CMDOUT) LENGTH(PLENGTH1) NOHANDLE
         CLC   EIBRESP,DFHRESP(NORMAL)
         BE    P#NEW@2
         MVC   EMSG,=CL78' '
         MVC   EMSG(41),=C'INQ OF PROGRAM INFO FAILED BEFORE NEWCOPY'   DPSO7027
         L     15,=V(P#CMD@E)
         BR    15
P#NEW@2  EQU   *
         EXEC CICS SET PROGRAM(CMDOUT) NEWCOPY NOHANDLE
         CLC   EIBRESP,DFHRESP(NORMAL)
         BE    P#NEW@3
         MVC   EMSG,=CL78' '
         MVC   EMSG(14),=C'NEWCOPY FAILED'
         L     15,=V(P#CMD@E)
         BR    15
P#NEW@3  EQU   *
         EXEC CICS INQUIRE PROGRAM(CMDOUT) LENGTH(PLENGTH2) NOHANDLE
         CLC   EIBRESP,DFHRESP(NORMAL)
         BE    P#NEW@4
         MVC   EMSG,=CL78' '
         MVC   EMSG(40),=C'INQ OF PROGRAM INFO FAILED AFTER NEWCOPY'
         L     15,=V(P#CMD@E)
         BR    15
P#NEW@4  EQU   *
         MVI   EMSG,C' '
         MVC   EMSG+1(L'EMSG-1),EMSG
         MVC   EMSG(8),CMDOUT
         MVC   EMSG+8(14),=C' NEW COPIED - '
         MVC   EMSG+22(11),=C'OLD LENGTH('
         FW2DEC8 PLENGTH1,EMSG+33
         MVC   EMSG+41(14),=C')  NEW LENGTH('
         FW2DEC8 PLENGTH2,EMSG+55
         MVI   EMSG+63,C')'
         L     15,=V(P#PPT)
         BR    15
PLENGTH1 DS    F
PLENGTH2 DS    F
         SPACE 4
         LTORG
         EJECT
         MEND
         MACRO
         FRED9                                                          DPSO7027
         GBLB  &B2SF,&H2CF,&H2DF,&ORF,&ORHF,&GINF,&C2HF,&MVS            DPSO7027
         GBLC  &CS,&VERS                                                DPSO7027
CMDS4    CSECT                                                          DPSO7027
         USING *,7                                                      DPSO7027
P#OPEN   EQU   *                                                        DPSO7027
         AIF   (&MVS).MVS67                                             DPSO7027
         BALR  7,0                                                      DPSO7027
         AGO   .MVS68                                                   DPSO7027
.MVS67   ANOP                                                           DPSO7027
         BASR  7,0                                                      DPSO7027
.MVS68   ANOP                                                           DPSO7027
         LA    15,*-CMDS4                                               DPSO7027
         SR    7,15                                                     DPSO7027
         EXEC CICS SET DATASET(CMDOUT) OPEN                             DPSO7027
         CLC   EIBRESP,DFHRESP(NORMAL)                                  DPSO7027
         BNE   P#OPENER                                                 DPSO7027
         EXEC CICS SET DATASET(CMDOUT) ENABLED                          DPSO7027
         CLC   EIBRESP,DFHRESP(NORMAL)                                  DPSO7027
         BNE   P#OPENER                                                 DPSO7027
         MVI   EMSG,C' '                                                DPSO7027
         MVC   EMSG+1(L'EMSG-1),EMSG                                    DPSO7027
         MVC   EMSG(8),CMDOUT                                           DPSO7027
         MVC   EMSG+8(17),=C' - OPENED ENABLED'                         DPSO7027
         L     15,=V(P#CMD@N)                                           DPSO7027
         BR    15                                                       DPSO7027
P#OPENER EQU   *                                                        DPSO7027
         MVC   EMSG,=CL78' '
         MVC   EMSG(11),=C'OPEN FAIRED'                                 DPSO7027
         L     15,=V(P#CMD@E)                                           DPSO7027
         BR    15                                                       DPSO7027
P#CLOSE  EQU   *                                                        DPSO7027
         AIF   (&MVS).MVS65                                             DPSO7027
         BALR  7,0                                                      DPSO7027
         AGO   .MVS66                                                   DPSO7027
.MVS65   ANOP                                                           DPSO7027
         BASR  7,0                                                      DPSO7027
.MVS66   ANOP                                                           DPSO7027
         LA    15,*-CMDS4                                               DPSO7027
         SR    7,15                                                     DPSO7027
         EXEC CICS SET DATASET(CMDOUT) CLOSED                           DPSO7027
         CLC   EIBRESP,DFHRESP(NORMAL)                                  DPSO7027
         BNE   P#CLOSER                                                 DPSO7027
         EXEC CICS SET DATASET(CMDOUT) DISABLED                         DPSO7027
         CLC   EIBRESP,DFHRESP(NORMAL)                                  DPSO7027
         BNE   P#CLOSER                                                 DPSO7027
         MVI   EMSG,C' '                                                DPSO7027
         MVC   EMSG+1(L'EMSG-1),EMSG                                    DPSO7027
         MVC   EMSG(8),CMDOUT                                           DPSO7027
         MVC   EMSG+8(18),=C' - CLOSED DISABLED'                        DPSO7027
         L     15,=V(P#CMD@N)                                           DPSO7027
         BR    15                                                       DPSO7027
P#CLOSER EQU   *                                                        DPSO7027
         MVC   EMSG,=CL78' '
         MVC   EMSG(12),=C'CLOSE FAIRED'                                DPSO7027
         L     15,=V(P#CMD@E)                                           DPSO7027
         BR    15                                                       DPSO7027
P#SEND   EQU   *                                                        DPSO7027
         AIF   (&MVS).MVS63                                             DPSO7027
         BALR  7,0                                                      DPSO7027
         AGO   .MVS64                                                   DPSO7027
.MVS63   ANOP                                                           DPSO7027
         BASR  7,0                                                      DPSO7027
.MVS64   ANOP                                                           DPSO7027
         LA    15,*-CMDS4                                               DPSO7027
         SR    7,15                                                     DPSO7027
         BAL   11,GETMAPS                                               DPSO7027
         USING MDI,6                                                    DPSO7027
P#SEND@1 EQU   *                                                        DPSO7027
         EXEC CICS GETMAIN SET(5) LENGTH(MDIIWAL) INITIMG(X'00')        DPSO7027
         LR    4,5                                                      DPSO7027
         LA    4,12(4)                                                  DPSO7027
         LA    6,MDI#L(6)                                               DPSO7027
         USING MDF,6                                                    DPSO7027
P#SEND@2 EQU   *                                                        DPSO7027
         CLC   MDFPGPOS,=X'FFFF'                                        DPSO7027
         BE    P#SEND@7                                                 DPSO7027
         LH    1,MDFLNG                                                 DPSO7027
         TM    MDFFLAG,MDFFDSCT                                         DPSO7027
         BNO   P#SEND@6                                                 DPSO7027
         TM    MDFFLAG,MDFFDFT                                          DPSO7027
         BNO   P#SEND@4                                                 DPSO7027
         LR    2,1                                                      DPSO7027
         BCTR  2,0                                                      DPSO7027
         EX    2,SENDCLC                                                DPSO7027
         BNE   P#SEND@5                                                 DPSO7027
P#SEND@4 EQU   *                                                        DPSO7027
         TM    MDFATTR,(MDFAPROT+MDFANUM)                               DPSO7027
         BO    *+20                                                     DPSO7027
         TM    MDFATTR,MDFANUM                                          DPSO7027
         BNO   *+12                                                     DPSO7027
         MVI   3(4),C'9'                                                DPSO7027
         B     *+8                                                      DPSO7027
         MVI   3(4),C'X'                                                DPSO7027
         CH    1,=H'1'                                                  DPSO7027
         BNH   P#SEND@5                                                 DPSO7027
         LR    2,1                                                      DPSO7027
         SH    2,=H'2'                                                  DPSO7027
         EX    2,SENDMOVE                                               DPSO7027
P#SEND@5 EQU   *                                                        DPSO7027
         LA    4,3(1,4)                                                 DPSO7027
P#SEND@6 EQU   *                                                        DPSO7027
         TM    MDFFLAG,MDFFDFT                                          DPSO7027
         BNO   *+8                                                      DPSO7027
         LA    6,0(1,6)                                                 DPSO7027
         LA    6,MDF#L(6)                                               DPSO7027
         B     P#SEND@2                                                 DPSO7027
P#SEND@7 EQU   *                                                        DPSO7027
         CLC   SMAP,=CL8' '                                             DPSO7027
         BE    P#SEND@8                                                 DPSO7027
         EXEC CICS SEND MAPSET(SMAPSET) MAP(SMAP) FROM(0(5)) ERASE     XDPSO7027
               NOHANDLE                                                 DPSO7027
         B     P#SEND@9                                                 DPSO7027
P#SEND@8 EQU   *                                                        DPSO7027
         EXEC CICS SEND MAP(SMAPSET) FROM(0(5)) ERASE NOHANDLE          DPSO7027
P#SEND@9 EQU   *                                                        DPSO7027
         CLC   EIBRESP,DFHRESP(NORMAL)                                  DPSO7027
         BE    P#SEND@Z                                                 DPSO7027
         MVC   EMSG,=CL78' '
         MVC   EMSG(12),=C'INVALID SEND'                                DPSO7027
         L     15,=V(P#CMD@E)                                           DPSO7027
         BR    15                                                       DPSO7027
P#SEND@Z EQU   *                                                        DPSO7027
         OI    CMDSW,JUSTSEND                                           DPSO7027
         NI    CMDSW,X'FF'-NOERASE                                      DPSO7027
         EXEC CICS RETURN TRANSID(EIBTRNID) COMMAREA(COMM)             XDPSO7027
               LENGTH(=Y(COMML))                                        DPSO7027
SENDMOVE MVC   4(*-*,4),3(4)                                            DPSO7027
SENDCLC  CLC   MDF#L(*-*,6),SENDSP                                      DPSO7027
SENDSP   DC    256C' '                                                  DPSO7027
P#SENDE  EQU   *                                                        DPSO7027
         AIF   (&MVS).MVS73                                             DPSO7027
         BALR  7,0                                                      DPSO7027
         AGO   .MVS74                                                   DPSO7027
.MVS73   ANOP                                                           DPSO7027
         BASR  7,0                                                      DPSO7027
.MVS74   ANOP                                                           DPSO7027
         LA    15,*-CMDS4                                               DPSO7027
         SR    7,15                                                     DPSO7027
         BAL   11,GETMAPS                                               DPSO7027
         USING MDI,6                                                    DPSO7027
         CLC   SMAP,=CL8' '                                             DPSO7027
         BE    P#SENDE2                                                 DPSO7027
         EXEC CICS SEND MAPSET(SMAPSET) MAP(SMAP) MAPONLY ERASE        XDPSO7027
               NOHANDLE                                                 DPSO7027
         B     P#SENDE3                                                 DPSO7027
P#SENDE2 EQU   *                                                        DPSO7027
         EXEC CICS SEND MAP(SMAPSET) MAPONLY ERASE NOHANDLE             DPSO7027
P#SENDE3 EQU   *                                                        DPSO7027
         CLC   EIBRESP,DFHRESP(NORMAL)                                  DPSO7027
         BE    P#SENDE4                                                 DPSO7027
         MVC   EMSG,=CL78' '
         MVC   EMSG(12),=C'INVALID SEND'                                DPSO7027
         L     15,=V(P#CMD@E)                                           DPSO7027
         BR    15                                                       DPSO7027
P#SENDE4 EQU   *                                                        DPSO7027
         OI    CMDSW,JUSTSEND                                           DPSO7027
         NI    CMDSW,X'FF'-NOERASE                                      DPSO7027
         EXEC CICS RETURN TRANSID(EIBTRNID) COMMAREA(COMM)             XDPSO7027
               LENGTH(=Y(COMML))                                        DPSO7027
GETMAPS  EQU   *                                                        DPSO7027
         MVI   SMAPSET,C' '                                             DPSO7027
         MVC   SMAPSET+1(15),SMAPSET                                    DPSO7027
         LA    4,CMDOUT                                                 DPSO7027
         LH    2,CMDOLEN                                                DPSO7027
         CH    2,=H'16'                                                 DPSO7027
         BNH   *+8                                                      DPSO7027
         LA    2,16                                                     DPSO7027
         LA    3,SMAPSET                                                DPSO7027
GM#0     EQU   *                                                        DPSO7027
         CLI   0(4),C'-'                                                DPSO7027
         BNE   *+12                                                     DPSO7027
         LA    3,SMAP                                                   DPSO7027
         B     GM#1                                                     DPSO7027
         MVC   0(1,3),0(4)                                              DPSO7027
         LA    3,1(3)                                                   DPSO7027
GM#1     EQU   *                                                        DPSO7027
         LA    4,1(4)                                                   DPSO7027
         BCT   2,GM#0                                                   DPSO7027
         EXEC CICS LOAD PROGRAM(SMAPSET) ENTRY(6) NOHANDLE              DPSO7027
         CLC   EIBRESP,DFHRESP(NORMAL)                                  DPSO7027
         BE    GM#2                                                     DPSO7027
         MVC   EMSG,=CL78' '
         MVC   EMSG(29),=C'INVALID MAPSET NAME SPECIFIED'               DPSO7027
         L     15,=V(P#CMD@E)                                           DPSO7027
         BR    15                                                       DPSO7027
GM#2     EQU   *                                                        DPSO7027
         LA    6,MSD#L(6)                                               DPSO7027
         USING MDI,6                                                    DPSO7027
         CLC   SMAP,=CL8' '                                             DPSO7027
         BER   11                                                       DPSO7027
GM#3     EQU   *                                                        DPSO7027
         CLC   MDINAME,SMAP                                             DPSO7027
         BER   11                                                       DPSO7027
         CLC   MDIMDL,=X'FFFF'                                          DPSO7027
         BE    GM#4                                                     DPSO7027
         LH    4,MDIMAPL                                                DPSO7027
         LA    6,0(4,6)                                                 DPSO7027
         B     GM#3                                                     DPSO7027
GM#4     EQU   *                                                        DPSO7027
         MVC   EMSG,=CL78' '
         MVC   EMSG(26),=C'INVALID MAP NAME SPECIFIED'                  DPSO7027
         L     15,=V(P#CMD@E)                                           DPSO7027
         BR    15                                                       DPSO7027
SMAPSET  DS    CL8                                                      DPSO7027
SMAP     DS    CL8                                                      DPSO7027
P#ABENDF EQU   *                                                        DPSO7027
         AIF   (&MVS).MVSD61                                            DPSO7027
         BALR  7,0                                                      DPSO7027
         AGO   .MVSD62                                                  DPSO7027
.MVSD61  ANOP                                                           DPSO7027
         BASR  7,0                                                      DPSO7027
.MVSD62  ANOP                                                           DPSO7027
         LA    15,*-CMDS4                                               DPSO7027
         SR    7,15                                                     DPSO7027
         OI    CMDSW,ABENDOFF                                           DPSO7027
         L     15,=V(P#CMD@N)                                           DPSO7027
         BR    15                                                       DPSO7027
P#ABENDO EQU   *                                                        DPSO7027
         AIF   (&MVS).MVSO63                                            DPSO7027
         BALR  7,0                                                      DPSO7027
         AGO   .MVSO64                                                  DPSO7027
.MVSO63  ANOP                                                           DPSO7027
         BASR  7,0                                                      DPSO7027
.MVSO64  ANOP                                                           DPSO7027
         LA    15,*-CMDS4                                               DPSO7027
         SR    7,15                                                     DPSO7027
         NI    CMDSW,X'FF'-ABENDOFF                                     DPSO7027
         L     15,=V(P#CMD@N)                                           DPSO7027
         BR    15                                                       DPSO7027
P#AFCB   EQU   *                                                        DPSO7027
         AIF   (&MVS).MVSB61                                            DPSO7027
         BALR  7,0                                                      DPSO7027
         AGO   .MVSB62                                                  DPSO7027
.MVSB61  ANOP                                                           DPSO7027
         BASR  7,0                                                      DPSO7027
.MVSB62  ANOP                                                           DPSO7027
         LA    15,*-CMDS4                                               DPSO7027
         SR    7,15                                                     DPSO7027
         CLI   OPSYS,C'E'                                               DPSO7027
         BE    *+28                                                     DPSO7027
         L     5,16                                                     DPSO7027
         L     5,0(5)                                                   DPSO7027
         L     5,4(5)                                                   DPSO7027
         L     5,X'D0'(5)                                               DPSO7027
         L     5,X'14'(5)                                               DPSO7027
         B     *+12                                                     DPSO7027
         L     5,X'14'                                                  DPSO7027
         L     5,X'B4'(5)                                               DPSO7027
         ST    5,ADDRESS                                                DPSO7027
         BUMP  2,ADDRESS                                                DPSO7027
         XC    COFFSET,COFFSET                                          DPSO7027
         L     15,=V(P#CMD@N)                                           DPSO7027
         BR    15                                                       DPSO7027
P#AICB   EQU   *                                                        DPSO7027
         AIF   (&MVS).MVSA61                                            DPSO7027
         BALR  7,0                                                      DPSO7027
         AGO   .MVSA62                                                  DPSO7027
.MVSA61  ANOP                                                           DPSO7027
         BASR  7,0                                                      DPSO7027
.MVSA62  ANOP                                                           DPSO7027
         LA    15,*-CMDS4                                               DPSO7027
         SR    7,15                                                     DPSO7027
         CLI   OPSYS,C'E'                                               DPSO7027
         BE    *+28                                                     DPSO7027
         L     5,16                                                     DPSO7027
         L     5,0(5)                                                   DPSO7027
         L     5,4(5)                                                   DPSO7027
         L     5,X'D0'(5)                                               DPSO7027
         L     5,X'14'(5)                                               DPSO7027
         B     *+12                                                     DPSO7027
         L     5,X'14'                                                  DPSO7027
         L     5,X'B4'(5)                                               DPSO7027
         USING DFHAFCB,5                                                DPSO7027
         L     5,AFAICB                 @ OF @ EIQ (USED BY DFHEI1)     DPSO7027
         ST    5,ADDRESS                                                DPSO7027
         BUMP  2,ADDRESS                                                DPSO7027
         XC    COFFSET,COFFSET                                          DPSO7027
         L     15,=V(P#CMD@N)                                           DPSO7027
         BR    15                                                       DPSO7027
P#XEMTON EQU   *                                                        DPSO7027
         AIF   (&MVS).MVSO61                                            DPSO7027
         BALR  7,0                                                      DPSO7027
         AGO   .MVSO62                                                  DPSO7027
.MVSO61  ANOP                                                           DPSO7027
         BASR  7,0                                                      DPSO7027
.MVSO62  ANOP                                                           DPSO7027
         LA    15,*-CMDS4                                               DPSO7027
         SR    7,15                                                     DPSO7027
         EXEC CICS LOAD PROGRAM('KPS1127') HOLD                         DPSO7027
         CLI   OPSYS,C'E'                                               DPSO7027
         BE    *+28                                                     DPSO7027
         L     5,16                                                     DPSO7027
         L     5,0(5)                                                   DPSO7027
         L     5,4(5)                                                   DPSO7027
         L     5,X'D0'(5)                                               DPSO7027
         L     5,X'14'(5)                                               DPSO7027
         B     *+12                                                     DPSO7027
         L     5,X'14'                                                  DPSO7027
         L     5,X'B4'(5)                                               DPSO7027
         USING DFHAFCB,5                                                DPSO7027
         L     5,AFAICB                 @ OF @ EIQ (USED BY DFHEI1)     DPSO7027
         USING DFHAICB,5                                                DPSO7027
         L     6,DFHAIEXC               @ EIQ                           DPSO7027
*        L     1,=V(TRAP)               GET @ TRAP ROUTINE              DPSO6170
*        CR    1,6                      TRAP ALREADY SET ?              DPSO6170
*        BE    P#XEMTOX                                                 DPSO6170
         B     P#XEMTOX                                                 DPSO6170
         ST    6,SAVEIQ                 SAVE @ EIQ                      DPSO7027
         ST    1,DFHAIEXC               SET TRAP                        DPSO7027
P#XEMTOX EQU   *                                                        DPSO7027
         L     15,=V(P#CMD@N)                                           DPSO7027
         BR    15                                                       DPSO7027
P#XEMTFF EQU   *                                                        DPSO7027
         AIF   (&MVS).MVSF61                                            DPSO7027
         BALR  7,0                                                      DPSO7027
         AGO   .MVSF62                                                  DPSO7027
.MVSF61  ANOP                                                           DPSO7027
         BASR  7,0                                                      DPSO7027
.MVSF62  ANOP                                                           DPSO7027
         LA    15,*-CMDS4                                               DPSO7027
         SR    7,15                                                     DPSO7027
         CLI   OPSYS,C'E'                                               DPSO7027
         BE    *+28                                                     DPSO7027
         L     5,16                                                     DPSO7027
         L     5,0(5)                                                   DPSO7027
         L     5,4(5)                                                   DPSO7027
         L     5,X'D0'(5)                                               DPSO7027
         L     5,X'14'(5)                                               DPSO7027
         B     *+12                                                     DPSO7027
         L     5,X'14'                                                  DPSO7027
         L     5,X'B4'(5)                                               DPSO7027
         USING DFHAFCB,5                                                DPSO7027
         L     5,AFAICB                 @ OF @ EIQ (USED BY DFHEI1)     DPSO7027
         USING DFHAICB,5                                                DPSO7027
         OC    SAVEIQ,SAVEIQ                                            DPSO7027
         BZ    P#XEMTFX                                                 DPSO7027
         MVC   DFHAIEXC,SAVEIQ                                          DPSO7027
         XC    SAVEIQ,SAVEIQ                                            DPSO7027
         EXEC CICS RELEASE PROGRAM('KPS1127')                           DPSO7027
P#XEMTFX EQU   *                                                        DPSO7027
         L     15,=V(P#CMD@N)                                           DPSO7027
         BR    15                                                       DPSO7027
P#CEMT   EQU   *                                                        DPSO7027
         AIF   (&MVS).MVS61                                             DPSO7027
         BALR  7,0                                                      DPSO7027
         AGO   .MVS62                                                   DPSO7027
.MVS61   ANOP                                                           DPSO7027
         BASR  7,0                                                      DPSO7027
.MVS62   ANOP                                                           DPSO7027
         LA    15,*-CMDS4                                               DPSO7027
         SR    7,15                                                     DPSO7027
         LA    2,CEMTCMD                                                DPSO7027
         ST    2,CEMT1                                                  DPSO7027
         MVC   CEMT2,=A(CEMTCMDL)                                       DPSO7027
         MVC   CEMT3,=A(CEMTX)                                          DPSO7027
         MVC   CEMT4,=A(CEMTD)                                          DPSO7027
         LA    2,CEMTLOOP                                               DPSO7027
         ST    2,CEMT4                                                  DPSO7027
         LA    2,FLDLEN                                                 DPSO7027
         ST    2,CEMT5                                                  DPSO7027
         EXEC CICS LOAD PROGRAM('KPS1127') HOLD                         DPSO7027
         MVI   CEMTLOOP,C'Y'                                            DPSO7027
         CLI   OPSYS,C'E'                                               DPSO7027
         BE    *+28                                                     DPSO7027
         L     5,16                                                     DPSO7027
         L     5,0(5)                                                   DPSO7027
         L     5,4(5)                                                   DPSO7027
         L     5,X'D0'(5)                                               DPSO7027
         L     5,X'14'(5)                                               DPSO7027
         B     *+12                                                     DPSO7027
         L     5,X'14'                                                  DPSO7027
         L     5,X'B4'(5)                                               DPSO7027
         USING DFHAFCB,5                                                DPSO7027
         L     5,AFAICB                 @ OF @ EIQ (USED BY DFHEI1)     DPSO7027
         USING DFHAICB,5                                                DPSO7027
         L     6,DFHAIEXC               @ EIQ                           DPSO7027
*        L     1,=V(TRAP)               GET @ TRAP ROUTINE              DPSO6170
*        CR    1,6                      TRAP ALREADY SET ?              DPSO6170
*        BE    P#CEMT@2                                                 DPSO6170
         B     P#CEMT@2                                                 DPSO6170
         ST    6,SAVEIQ                 SAVE @ EIQ                      DPSO7027
         ST    1,DFHAIEXC               SET TRAP                        DPSO7027
         B     P#CEMT@2                                                 DPSO7027
         ENTRY SAVEIQ                                                   DPSO7027
SAVEIQ   DS    F                                                        DPSO7027
         SPACE 4                                                        DPSO7027
P#CEMT@2 EQU   *                                                        DPSO7027
         TR    CEMTCMD,TRTAB                                            DPSO7027
         EXEC CICS LINK PROGRAM('DFHEMTA') COMMAREA(CEMTPRMS)          XDPSO7027
               LENGTH(20)                                               DPSO7027
         CLC   CEMTCMD(5),=C' CEMT'                                     DPSO7027
         BE    P#CEMT@3                                                 DPSO7027
         CLC   CEMTCMD(4),=C'CEMT'                                      DPSO7027
         BE    P#CEMT@3                                                 DPSO7027
         MVC   NEWCMD,CEMTCMD                                           DPSO7027
         LA    4,NEWCMD+5                                               DPSO7027
         NI    CMDSW,X'FF'-NOERASE                                      DPSO7027
         MVC   DFHAIEXC,SAVEIQ                                          DPSO7027
         XC    SAVEIQ,SAVEIQ                                            DPSO7027
         EXEC CICS RELEASE PROGRAM('KPS1127')                           DPSO7027
         ST    13,REG13                                                 DPSO7027
         LA    13,SAVEAREA                                              DPSO7027
         L     15,=V(CMDS)                                              DPSO7027
         AIF   (&MVS).MVSC1                                             DPSO7027
         BALR  14,15                                                    DPSO7027
         AGO   .MVSC2                                                   DPSO7027
.MVSC1   ANOP                                                           DPSO7027
         BASR  14,15                                                    DPSO7027
.MVSC2   ANOP                                                           DPSO7027
         L     13,REG13                                                 DPSO7027
         B     P#CEMT@4                                                 DPSO7027
P#CEMT@3 EQU   *                                                        DPSO7027
         CLI   CEMTLOOP,C'N'                                            DPSO7027
         BNE   P#CEMT@2                                                 DPSO7027
         NI    CMDSW,X'FF'-NOERASE                                      DPSO7027
         MVC   DFHAIEXC,SAVEIQ                                          DPSO7027
         XC    SAVEIQ,SAVEIQ                                            DPSO7027
         EXEC CICS RELEASE PROGRAM('KPS1127')                           DPSO7027
P#CEMT@4 EQU   *                                                        DPSO7027
         L     15,=V(DISPLAY)                                           DPSO7027
         BR    15                                                       DPSO7027
P#XEMT   EQU   *                                                        DPSO7027
         AIF   (&MVS).MVSX61                                            DPSO7027
         BALR  7,0                                                      DPSO7027
         AGO   .MVSX62                                                  DPSO7027
.MVSX61  ANOP                                                           DPSO7027
         BASR  7,0                                                      DPSO7027
.MVSX62  ANOP                                                           DPSO7027
         LA    15,*-CMDS4                                               DPSO7027
         SR    7,15                                                     DPSO7027
         LA    2,CEMTCMD                                                DPSO7027
         ST    2,CEMT1                                                  DPSO7027
         MVC   CEMT2,=A(CEMTCMDL)                                       DPSO7027
         MVC   CEMT3,=A(CEMTX)                                          DPSO7027
         MVC   CEMT4,=A(CEMTD)                                          DPSO7027
         LA    2,CEMTLOOP                                               DPSO7027
         ST    2,CEMT4                                                  DPSO7027
         LA    2,FLDLEN                                                 DPSO7027
         ST    2,CEMT5                                                  DPSO7027
P#XEMT@2 EQU   *                                                        DPSO7027
         TR    CEMTCMD,TRTAB                                            DPSO7027
         EXEC CICS LINK PROGRAM('DFHEMTA') COMMAREA(CEMTPRMS)          XDPSO7027
               LENGTH(20)                                               DPSO7027
         CLC   CEMTCMD(5),=C' CEMT'                                     DPSO7027
         BE    P#XEMT@3                                                 DPSO7027
         CLC   CEMTCMD(4),=C'CEMT'                                      DPSO7027
         BE    P#XEMT@3                                                 DPSO7027
         MVC   NEWCMD,CEMTCMD                                           DPSO7027
         LA    4,NEWCMD+5                                               DPSO7027
         NI    CMDSW,X'FF'-NOERASE                                      DPSO7027
         ST    13,REG13                                                 DPSO7027
         LA    13,SAVEAREA                                              DPSO7027
         L     15,=V(CMDS)                                              DPSO7027
         AIF   (&MVS).MVSXC1                                            DPSO7027
         BALR  14,15                                                    DPSO7027
         AGO   .MVSXC2                                                  DPSO7027
.MVSXC1  ANOP                                                           DPSO7027
         BASR  14,15                                                    DPSO7027
.MVSXC2  ANOP                                                           DPSO7027
         L     13,REG13                                                 DPSO7027
         B     P#XEMT@4                                                 DPSO7027
P#XEMT@3 EQU   *                                                        DPSO7027
         CLI   CEMTLOOP,C'N'                                            DPSO7027
         BNE   P#XEMT@2                                                 DPSO7027
         NI    CMDSW,X'FF'-NOERASE                                      DPSO7027
P#XEMT@4 EQU   *                                                        DPSO7027
         L     15,=V(DISPLAY)                                           DPSO7027
         BR    15                                                       DPSO7027
CEMTCMDL DC    H'70'                                                    DPSO7027
CEMTX    DC    X'80'                                                    DPSO7027
CEMTL    DC    H'1'                                                     DPSO7027
TRTAB    EQU   *                                                        DPSO7027
TR00#0F  DC    X'400102030405060708090A0B0C0D0E0F'                      DPSO7027
TR10#1F  DC    X'101112131415161718191A1B1C1D1E1F'                      DPSO7027
TR20#2F  DC    X'202122232425262728292A2B2C2D2E2F'                      DPSO7027
TR30#3F  DC    X'303132333435363738393A3B3C3D3E3F'                      DPSO7027
TR40#4F  DC    X'404142434445464748494A4B4C4D4E4F'                      DPSO7027
TR50#5F  DC    X'505152535455565758595A5B5C5D5E5F'                      DPSO7027
TR60#6F  DC    X'606162636465666768696A6B6C406E6F'                      DPSO7027
TR70#7F  DC    X'707172737475767778797A7B7C7D7E7F'                      DPSO7027
TR80#8F  DC    X'808182838485868788898A8B8C8D8E8F'                      DPSO7027
TR90#9F  DC    X'909192939495969798999A9B9C9D9E9F'                      DPSO7027
TRA0#AF  DC    X'A0A1A2A3A4A5A6A7A8A9AAABACADAEAF'                      DPSO7027
TRB0#BF  DC    X'B0B1B2B3B4B5B6B7B8B9BABBBCBDBEBF'                      DPSO7027
TRC0#CF  DC    X'C0C1C2C3C4C5C6C7C8C9CACBCCCDCECF'                      DPSO7027
TRD0#DF  DC    X'D0D1D2D3D4D5D6D7D8D9DADBDCDDDEDF'                      DPSO7027
TRE0#EF  DC    X'E0E1E2E3E4E5E6E7E8E9EAEBECEDEEEF'                      DPSO7027
TRF0#FF  DC    X'F0F1F2F3F4F5F6F7F8F9FAFBFCFDFEFF'                      DPSO7027
CEMTD    DS    X                                                        DPSO7027
         SPACE 4                                                        DPSO7027
         LTORG                                                          DPSO7027
         EJECT                                                          DPSO7027
         MEND                                                           DPSO7027
         MACRO                                                          DPSO7027
         FRED7
KPS1127  CSECT
         USING DFHTCADS,TCACBAR                                         DPSO7027
         USING KPS1127,7
         LTORG                                                          DPSO7027
         MEND
DFHEISTG DSECT
         FRED1
         FRED
         FRED2
         FRED3
         FRED4
         FRED5
         FRED6
         FRED8                                                          DPSO7027
         FRED9                                                          DPSO7027
         FRED7
         END
